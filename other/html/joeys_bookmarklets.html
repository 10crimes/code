<HTML>
<HEAD>
	<TITLE>Joey's Bookmarklet (Development) Page</TITLE>
	<!-- Keep viewer safe from infinte alert trap! -->
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/alert_watcher.user.js'></SCRIPT>
	<!-- TESTING -->
</HEAD>
<BODY>

<H2>Joey's Bookmarklet (Dev<A class='hiddenlink' href='#dev'>elopm</A>ent) Page</H2>

<P align='right'>
See also: <A href='http://hwi.ath.cx/xslt/live/minitools/show_minitools.html'>Joey's Minitools/Bookmarklets</A>
</P>

<H3>Introduction</H3>
<BLOCKQUOTE>

	<P>Bookmarklets are a bit like Bookmarks, but instead of taking you to a web page, they perform useful actions on the page you are viewing.</P>
	<P>Click on a bookmarklet below to try it out.  (Reload the page or navigate back if you don&apos;t like the results!)</P>
	<P>To copy a bookmarklet so you can use it later, drag the link to your Bookmarks Toolbar, or right-click to bookmark it.</P>
	<P>Known bugs and TODOs are <font class='todo'>shown in orange</font>, changes and added features <font class='done'>in green</font>.</P>

</BLOCKQUOTE>

<!--
<H3>Testing Bookmarklets</H3>
<BLOCKQUOTE>
	<P>The bookmarklets in this section are IN DEVELOPMENT!  You probably don't want to try using them just yet.  Go for the Ready to use Bookmarklets instead.</P>
</BLOCKQUOTE>
<SCRIPT type='text/javascript'> document.getElementsByTagName('BLOCKQUOTE')[0].style.backgroundColor='#cc8888'; </SCRIPT>
-->

<!-- I didn't feel like making a css class for that one-off. ;p -->



<H3>User Bookmarklets</H3>
<BLOCKQUOTE>

	<P>
		<LI><A href="javascript:(function(){
			var cnt = 0;
			function checkDoneLoading() {
				if (this.addFoldsToBlockQuotes != undefined) {
					window.status = 'Script loaded in '+(cnt*5)+'ms.';
					/*addFoldsToBlockQuotes();*/
					var tagTypes = new Array( 'ul', 'blockquote', 'table' );
					addFoldsToPage(tagTypes,false);
				} else {
					window.status = 'Waiting for modifyDOM script to load... ('+(++cnt)*5+'ms)';
					setTimeout('top.checkDoneLoading();',5);
				}
			}
			top.checkDoneLoading = checkDoneLoading;
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/modifyDOM.js';
			/** Good method but acts twice since we are using other method for Konqueror. **/
			/* newScript.onload = checkDoneLoading; */
			document.getElementsByTagName('head')[0].appendChild(newScript);
			/** Konqueror needs this: **/
			setTimeout('top.checkDoneLoading();',5);
		})();" keyword="keywordInjected" description="descriptionInjected" title="Version 0.9">Enable Page Folding</A></LI>
	</P>
	<!-- Nasty - At one point, FF was reloading all the resources except mosifyDOM.js, which is the one I was changing!  I cleared my cache and it stopped doing it after that. -->
	<BLOCKQUOTE>
		<P>Makes parts of the page collapsable and expandable, for easier navigation through large (tree-structured) pages.</P>
		<!-- <LI title="I had to fiddle the original solution, to get one that also worked with Konqueror.">This is my first Bookmarklet which loads an external javascript file.</LI> -->
		<!-- <LI class='done'>Fixed: If the item we decide to use as the handle is a link, clicking on it clicks the link, as well as collapsing/expanding the child block, which is undesirable.  The fix is that the user can open/close those folds now by hovering over the handle. Todo: Avoid the real cause of the problem, by making sure the fold handle image sits outside the link.</LI> -->
		 <LI class='todo'>Todo: We had to introduce a different loading technique for Konqueror.  But the FF way might be faster if we can detect that it will work.</LI>
		 <LI class='todo'>Currently collapses BLOCKQUOTEs, ULs and TABLEs.  Are there other tags it could collapse?  (Check the code, it's easy to add extra tags.)</LI>
		 <LI class='todo'>This version tries to find the text node immediately before the folding block, and assume that is a label.  That works well on some pages (such as this one) but not on all - some pages have blocks without any introduction text.  But if the block does have a header, and we don't use it as the label, that looks messy.  So we need to make a confident decision about whether we found a label or not.</LI>
		 <LI class='todo'>It acts on every element you move the mouse over, which can be a lot.  It could take a break while you move, if it doesn't highlight newly entered elements, it won't have to unhighlight them on the way out.</LI>
		 <LI class='todo'>We could even create blocks to compress where there was no structure.  E.g. create a block between two HR tags, provided the text content in between is large.  Or in fact squash any blocks containing text, if the text is >=15&perc; of the parent&apos;s text.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var scriptText = '<SCRIPT type=&quot;text/javascript&quot;>
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (linkNode.className == \'specialButton\')
							return;
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=\'#ddddff\';
						/* linkNode.parentNode.style.backgroundColor=\'#88ee88\'; */
						var colUp = linkNode.parentNode;
						while (colUp.getElementsByTagName(\'A\').length == 1) {
							colUp.style.backgroundColor=\'#bbbbff\';
							colUp = colUp.parentNode;
						}
						top.window.frames[1].location = linkNode.href;
						document.getElementById(\'closeSidebarLink\').href = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(\'doGet();\',700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					var linkElem = document.links[i];
					if (linkElem.className == \'specialButton\')
						continue;
					/*linkElem.target = \'_parent\';*/
					linkElem.target = \'previewFrame\';
					linkElem.onmouseover = eventHandler;
					linkElem.onmouseout = clearLinkNode;
					linkElem.onclick = eventHandler; /* Not really needed for navigation, since we have set target ok, but needed to update the highlight!  Unfortunately doesn_t succeed. :P */
				}
			</SCRIPT>\n';
			/* Safer but slower: */ var getback = document.location;
			/* Faster but messy on various sites: var getback = 'javascript:top.document.write(top.frames[0].document.documentElement.innerHTML);'; */
			var header = '<P align=\'right\'>[ <A class=\'specialButton\' id=\'closeSidebarLink\' title=\'Note: You will lose any navigation you have performed in the other frame.\' target=\'_top\'>Close This Sidebar</A> | <A class=\'specialButton\' target=\'_top\' href=\''+getback+'\'>Close Other Frame</A> ]</P>\n';
			var oldHTML = document.documentElement.innerHTML;
			oldHTML = header + oldHTML + scriptText;
			/*if (i<=0) { alert('Failed to find the body tag!'); return; }
			if (oldHTML.indexOf(scriptText) < 0) { alert('Insert failed.'); return; }
			document.write(oldHTML); return;*/
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			document.close();
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
		})();">Split Preview</A> version 0.88</LI>
		<BLOCKQUOTE>
			<P>Splits the page, placing the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.
			<LI title='Unfortunately the implementation is to navigate the window to the remaining page.  I doubt we can destroy the frameset without destroying the page.' class='done'>There are now two close buttons available to the user, one for each frame.</LI>
			<P class='todo'>Todo:</P>
			<BLOCKQUOTE>
				<LI class='todo'>Open the first link automatically.</LI>
				<LI class='todo'>Thin frame across the top of the two panes, containing all the buttons+options, including Next/Previous buttons.</LI>
				<LI class='todo'>Maybe also a squish/unsquish button for the sidebar (temporarily almost-maximize preview frame)?</LI>
				<LI class='todo'>Also might be nice to have 'MoveRightFrameToLeft' and also a back button for that feature.  This would describe a sort of history-tree-browsing way or surfing, somewhat similar to the early Gnome2 file-chooser.</LI>
				<LI class='todo'>Consider an alternative approach: forget the left frame, just have a thin top frame with all the links from the page presented as tabs, which open in the mainframe below.  We could even do this without frames, just a table and an IFrame (or a hidden stack/cache of IFrames).</LI>
				<LI class='todo'>Bug/Feature: By quickly clicking on a link then moving away, it is possible to leave the highlight behind on an earlier link.</LI>
				<LI class='external'>Note: Loads external script.</LI>
			</BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<!-- I found by setting target='_self', the URL in my browser's location bar was not changed to the script text, which looked messy. -->

	<P>
		<LI><A target="_self" href="javascript:(function(){
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/trim_elements.js';
			/* newScript.onload = (function(){ init(); }); */
			document.body.appendChild(newScript);
		})();">Trim to Search String</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Hides all parts of the page except those matching your search expression.</P>
		<LI class='todo'>This is much faster in Konqueror than in Firefox.</LI>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A target='_self' href='javascript:
			var info = document.links.length+" links on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<document.links.length;i++) {
				var link = document.links[i];
				html += "<TR><TD><A href=\""+(link.href)+"\">"+(link.text)+"</A></TD><TD>"+(link.href)+"</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			document.open();
			document.write(html);
			document.close();
		'>Just the Links</A></LI>
		<BLOCKQUOTE>
			Displays a list of all the links in the page.
			<P class='todo'>(This works badly on this page because the hrefs are poorly formatted, but on most pages it works fine!)</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			var images = document.getElementsByTagName("IMG"),
					info = images.length+" images on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<images.length;i++) {
				var image = images[i];
				html += "<TR><TD align=\"center\">\n";
				html += "&lt;IMG src=\""+image.src+"\"&gt;<BR/>\n";
				html += "<A href=\""+image.src+"\">"+image.src+"</A>\n";
				html += "</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			/* var w = open().document; */
			var w = document;
			w.open();
			w.write(html);
			w.close();
		'>Just the Images</A></LI>
		<BLOCKQUOTE>
			Displays a list of all the images in the page.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_blank";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_blank";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at New Window</A></LI>
		<BLOCKQUOTE>
			Use this if you want the browser to open a new window when you click on a link or button.  (E.g. you want to use the search form, but you don't want to leave the current page.)
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_self";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_self";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at This Window</A></LI>
		<BLOCKQUOTE>
			Use this if you want the browser to stay in the current window when you click on a link or button.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="
			javascript:
			function attachClickListener(node,clickProcessor) {
				if (node.captureEvents) {
					node.captureEvents(Event.CLICK);
				}
				node.onmouseup = clickProcessor;
				if (node.style) {
					node.style.cursor = (clickProcessor?'crosshair':'');
				}
				var kids = node.childNodes;
				for (var i=0;i<kids.length;i++) {
					attachClickListener(kids[i],clickProcessor);
				}
			}
			function processClick(evt) {
				var node = evt.currentTarget;
				window.status = 'Removed '+node;
				attachClickListener(document,null);
				node.innerHTML='';
				node.parentNode.removeChild(node);
			}
			attachClickListener(document,processClick);
		">Nuke next item clicked</A></LI>
	<BLOCKQUOTE>
		<P>Waits for user click, and removes whatever element they clicked on from the page.</P>
		<LI class='todo'>Todo: Needs 'undo' feature.</LI>
		<LI class='todo'>Todo: Add two icons to the page, one to re-use the bookmarklet, another to empty the Trash (undo the deletes).</LI>
		<LI class='todo'>Todo: Add info about what was destroyed (e.g. display its XPath in the statusbar, or in Trash list).</LI>
		<LI class='todo'>Todo: The element we want to destroy might not have any exposed surface to click on.  Maybe we can fatten out invisible/zero-size elements.  (E.g. mark each with a '.'s and give info on mouseover?)</LI>
	</BLOCKQUOTE>
	</P>

</BLOCKQUOTE>

<H3>Web-Developer Bookmarklets</H3>
<BLOCKQUOTE>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				node.onmouseover = doHighlight;
				node.onmouseout  = undoHighlight;
				/*
				var xpath = getXPath(node);
				if (node.style) {
					node.style.backgroundColor = '#' + getColorFor(simplexpath);
				}
				node.title = simplexpath;
				*/
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+39357) %25 52597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				/*if (Math.floor(Math.random()*6) == 5) {
					window.status = 'Did parseInt for \''+obj+'\' hash='+hash+' and got hex='+hex;
				}*/
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function doHighlight(evt) {
				var node = evt.currentTarget; /* try evt.srcElement if this fails. */
				var xpath = getXPath(node);
				/* Did not work: var simplexpath = xpath.replace(/\[[^]]*\]/g,''); */
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.tagName!='HTML' && node.tagName!='BODY') {
					node.title = xpath; /* this can break things if done on the wrong elements! */
					if (node.style) {
						node.style.backgroundColor = '#' + getColorFor(simplexpath);
					}
				}
				/** This might display the xpath of elements which don't display their title but can be rolled over. **/
				if (firstEvent) {
					firstEvent = false;
					/* Do whatever it is we want to do only on the topmost element. */
					window.status = xpath;
				} else {
					/*if (xpath == '/html') {*/
					if (node.tagName=='HTML' || node.tagName=='BODY') {
						firstEvent = true;
					}
				}
			}
			function undoHighlight(evt) {
				var node = evt.currentTarget;
				node.style.backgroundColor = 'white'; /*document.bgcolor;*/ /*parents bgcol?  original bgcol?!*/
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.nodeType == node.nodeType) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' );
			}
			processNode(document.body);
		})();">Highlight Structure</A> - Live Updates</LI>
		<BLOCKQUOTE>
			<P>Colours the background of every element in the document according to its path.</P>
			<P>Displays the XPath of the focused element as a popup (sets title attribute).</P>
			<LI class='todo'>The current &quot;webdeveloper&quot; version is psychedelic but informative.  We might want to make a friendlier few-colour version, for common browsing usage.  Example usage: The structure of this page (and some others on the web), whilst tree-like, is not immediately intuitive.  However if we were to set the background of all level 1 DIVs to green, and level 2 DIVs to blue, and level 3 BLOCKQUOTES to orange, etc., the page might be easier to navigate.</LI>
			<LI class='todo'>Can be sluggish to run on the heavier DOMs.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				/*node.onmouseover = doHighlight;
				node.onmouseout  = undoHighlight;*/
				var xpath = getXPath(node);
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.style) {
					node.style.backgroundColor = '#' + getColorFor(simplexpath);
				}
				node.title = simplexpath;
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+39357) %25 52597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				/*if (Math.floor(Math.random()*6) == 5) {
					window.status = 'Did parseInt for \''+obj+'\' hash='+hash+' and got hex='+hex;
				}*/
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function doHighlight(evt) {
				var node = evt.currentTarget; /* try evt.srcElement if this fails. */
				var xpath = getXPath(node);
				/* Did not work: var simplexpath = xpath.replace(/\[[^]]*\]/g,''); */
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.tagName!='HTML' && node.tagName!='BODY') {
					node.title = xpath; /* this can break things if done on the wrong elements! */
					if (node.style) {
						node.style.backgroundColor = '#' + getColorFor(simplexpath);
					}
				}
				/** This might display the xpath of elements which don't display their title but can be rolled over. **/
				if (firstEvent) {
					firstEvent = false;
					/* Do whatever it is we want to do only on the topmost element. */
					window.status = xpath;
				} else {
					/*if (xpath == '/html') {*/
					if (node.tagName=='HTML' || node.tagName=='BODY') {
						firstEvent = true;
					}
				}
			}
			function undoHighlight(evt) {
				var node = evt.currentTarget;
				node.style.backgroundColor = 'white'; /*document.bgcolor;*/ /*parents bgcol?  original bgcol?!*/
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.nodeType == node.nodeType) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' );
			}
			processNode(document.body);
		})();">Highlight Structure</A> - All In One Go</LI>
		<BLOCKQUOTE>
			<P>A modified version which does all the colouring in one go.</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="
			javascript:(function(){
				theForm = document.forms[0];
				theStr = '';
				for (i=0; i < theForm.elements.length; i++) {
					ele = theForm.elements[i];
					theStr += ele.name + ' : ' + ele.value + '\n';
				}
				alert (theStr);
			})();
		">Show Form Data</A></LI>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

</BLOCKQUOTE>

<H3 id='dev'>Bookmarklets under Development</H3>
<BLOCKQUOTE>

	<!-- <P>No bookmarklet in development on this page right now.  You probably wouldn't want to use it if it was. -->
	<!-- I might even consider separating my development and release pages. --></P>

	These are Bookmarklets I am still working on.  They may or may not work.

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var scriptText = '<SCRIPT type=&quot;text/javascript&quot;>
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (linkNode.className == \'specialButton\')
							return;
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=\'#bbffbb\';
						/* linkNode.parentNode.style.backgroundColor=\'#88ee88\'; */
						var colUp = linkNode.parentNode;
						while (colUp.getElementsByTagName(\'A\').length == 1) {
							colUp.style.backgroundColor=\'#88ee88\';
							colUp = colUp.parentNode;
						}
						top.window.frames[1].location = linkNode.href;
						document.getElementById(\'closeSidebarLink\').href = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(\'doGet();\',700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					var linkElem = document.links[i];
					if (linkElem.className == \'specialButton\')
						continue;
					/*linkElem.target = \'_parent\';*/
					linkElem.target = \'previewFrame\';
					linkElem.onmouseover = eventHandler;
					linkElem.onmouseout = clearLinkNode;
					linkElem.onclick = eventHandler; /* Not really needed for navigation, since we have set target ok, but needed to update the highlight!  Unfortunately doesn_t succeed. :P */
				}
				var lastWidth = 0;
				function toggleSideBar() {
					/** TODO: we should make everything in the sidebar, except for the toggle bar, invisible! **/
					/** TODO: On Konqueror, repeated toggling makes the frame smaller.  On Mozilla it works perfectly already. **/
					/** TODO: Need better style to fix the width of the toggleBar. **/
					if (lastWidth == 0) {
						top.window.frames[0].document.getElementById(\'rightRow\').style.display = \'none\';
						/*top.window.frames[0].document.getElementById(\'header\').style.display = \'none\';*/
						lastWidth = top.window.frames[0].window.innerWidth;
						/*alert(\'toggling!\');*/
						top.document.body.cols = \'32,*\';
						/*alert(\'cols = \'+top.document.body.cols);*/
						window.frames[0].document.getElementById(\'leftRow\').style.width = \'2px\';
					} else {
						top.document.body.cols = lastWidth + \',*\';
						lastWidth = 0;
						top.window.frames[0].document.getElementById(\'rightRow\').style.display = \'\';
						/*top.window.frames[0].document.getElementById(\'header\').style.display = \'\';*/
						window.frames[0].document.getElementById(\'leftRow\').style.width = \'18px\';
					}
				}
			</SCRIPT>\n';
			var toggler = '<A class=\'specialButton\' href=\'javascript:toggleSideBar();\'>Collapse</A> | ';
			/* Safer but slower: */ var getback = document.location;
			/* Faster but messy on various sites: var getback = 'javascript:top.document.write(top.frames[0].document.documentElement.innerHTML);'; */
			var header = '<P id=\'header\' align=\'right\'>[ ' + toggler + ' <A class=\'specialButton\' target=\'_top\' href=\''+getback+'\'>Restore</A> | <A class=\'specialButton\' id=\'closeSidebarLink\' target=\'_top\'>Close</A> ]</P>\n';
			var oldHTML = document.documentElement.innerHTML;
			oldHTML =
				'<TABLE cellpadding=\'4\'><TR><TD id=\'leftRow\' onclick=\'javascript:toggleSideBar();\' bgcolor=\'#aaaaff\' width=\'4px\' style=\'cursor:w-resize\'></TD><TD id=\'rightRow\' width=\'200px\'>\n'
				+ header
				+ oldHTML
				+ '</TD></TR></TABLE>\n'
				+ scriptText;
			/*if (i<=0) { alert('Failed to find the body tag!'); return; }
			if (oldHTML.indexOf(scriptText) < 0) { alert('Insert failed.'); return; }
			document.write(oldHTML); return;*/
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;400px,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			document.close();
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			window.frames[0].document.getElementById('header').style.position = 'absolute';
			window.frames[0].document.getElementById('header').style.top = '5px';
			window.frames[0].document.getElementById('header').style.right = '8px';
			/* window.frames[0].document.getElementById('header').style.setAttribute('z-index',100); */
			window.frames[0].document.getElementById('leftRow').style.width = '2px';
			/*window.frames[0].document.getElementById('leftRow').style.height = '100%2525';*/
			window.frames[0].document.getElementById('leftRow').style.height = top.window.innerHeight - 24;
		})();">Split Preview</A> version 0.89 DEV - Toggle</LI>
		<BLOCKQUOTE>
			<P>Splits the page, placing the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.
			<LI class='done'>This version provides a 'Togglebar' to flatten/unflatten the sidebar.</LI>
			<LI class='todo'>It's working quite OK in Firefox, but a bit messily in Konqueror.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="" title="Version 0.9">Auto Highlight</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Checks document.referrer and if it contains a search expression, assume this is a result page, and highlight the search terms.</P>
	</BLOCKQUOTE>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			function checkDoneLoading() {
				if (this.powerbar_init != undefined) {
					window.status = '';
					powerbar_init();
				} else {
					window.status = 'Waiting for add_powerbar script to load.';
					setTimeout('top.checkDoneLoading();',100);
				}
			}
			top.checkDoneLoading = checkDoneLoading;
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/add_powerbar.js';
			/** This method works for Mozilla but not Konqueror: **/
			/* newScript.onload = (function(){ powerbar_init(); }); */
			/* newScript.onload = checkDoneLoading; */
			/*newScript.onload = checkDoneLoading;*/
			/*document.getElementsByTagName('head')[0].appendChild(newScript);*/
			document.getElementsByTagName('head')[0].appendChild(newScript);
			/* no: document.body.appendChild(newScript); */
			/** Konqueror requires this method: **/
			/*setTimeout('top.checkDoneLoading();',50);*/
			/*setTimeout('powerbar_init();',5000);*/
			/*setTimeout('try {powerbar_init();} catch (e) { alert(e); }',5000);*/
		})();">Load Powerbar</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>My monstrous old web test environment, almost working through a bookmarklet!</P>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			window.open('http://www.google.com/search?as_lq='+escape(document.location),'_blank');
		})();">Google Pages that Link to This</A></LI> (in a new window)
	</P>
	<BLOCKQUOTE>
		<P>Finds other pages on the web which link to this page.</P>
	</BLOCKQUOTE>

</BLOCKQUOTE>

<H3>Wanted / TODO</H3>
<BLOCKQUOTE class='todo'>

	<P>
		MakeABookmarkletFromTheSearchFormOnThisPage ^^
	</P>

	<P>
		To help page investigation, colour every element (a bit like XPathGrabber does).
		And when we mouseover an element, show which one it is in the StatusBar (e.g. show it's XPath, since colour won't be possible in the StatusBar)p.
	</P>

	<P>
		Something similar to Preview Links in FloatingFrame, but instead split
		the window into two frames, put the current page in the left frame, and
		make all its links open the page in the right frame (when clicked, or
		hovered).
		It would be desirable to allow the split to be resized by the user.
		Also, be able to close the sideframe, or close the main frame.
	</P>

	<P>
		If I am viewing a page which is the result of a Google search, I may decide that the page is useless, and want to view another result.
		It would be great if the page could have a little icon added, which on hover would show the other search results, and let me switch to one of them.
		We may be able to use Referrer to determine if this page was obtained from a search-results page.  (Although actually, we could consider 'any' page as a 'list-of-links', we don't have to restrict this feature to search-result pages only.)
	</P>

	<P>
	<A href='javascript:
		'>Invisibly preload links when I mouseover them</A>
	<BLOCKQUOTE>
		Sometimes I am reading a page but I know where I am likely to go next.
		If I can preload that page then when I do follow the link, it will load fast when I do click.
	</BLOCKQUOTE>
	</P>

	<P>
		StripSearch.  Hides all elements except those containing the search text.  Ideal for tables.
	</P>

	<P>BatchNuke (aka BatchSelect*-1): User is given text box to enter an XPath.  (He can get xpath hints by mouseover the document.)  As he types the XPath, elements of the page are hidden, until he finds the XPath he wants.  Then he hits enter, they are permanently hidden/destroyed, and he can enter another XPath if he wishes.</P>

	<P>JavascriptConsole: Konqueror does not accept javascript: commands in the location bar.  How can I run little snippets of javascript on the page?  This Bookmarklet should popup a floating IFrame with a textarea where the user can edit and execute Javascript, and close it when finished.  For debugging but also for power-processing of pages.  (We may wish to append/include external .js files.)</P>

	<P>Bookmarklets and Framesets do not mix well.  Most Bookmarklets will try to target the frameset document rather than the child frame we are trying to focus on.  It would be nice to have a generic solution to this.</P>

</BLOCKQUOTE>

<H3>Older Versions</H3>
<BLOCKQUOTE>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=&quot;#ffff44&quot;;
						linkNode.parentNode.style.backgroundColor=&quot;#ffffbb&quot;;
						top.window.frames[1].location = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				/** This can cause a document overwrite when on Google results pages. **/
				/*document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);*/
			';
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.87</LI>
		<BLOCKQUOTE>
			<LI class='done'>Now highlighting the link which is being previewed.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						/*var rightFrame = top.document.getElementById(&quot;previewFrame&quot;);*/
						/*top.window.frames[1].document.documentElement.innerHTML = ... ;*/
						top.window.frames[1].document.write(&quot;&lt;BODY&gt;Loading &quot;+linkNode.href+&quot;...&lt;/BODY&gt;&quot;);
						/** Writing to the frame above causes the line below to fail in Konqueror. **/
						/** One fix might be to embed some javascript inside the body we just posted, to redirect the frame/page/doc. **/
						/*top.window.frames[1].src = linkNode.href;*/
						/** Oh this saves Konqueror :) **/
						top.window.frames[1].location = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.86</LI>
		<BLOCKQUOTE>
			<LI class='done'>Added loading page (nice for feedback, annoying afterwards).</LI>
			<LI class='done'>I set links to open in the right frame when clicked, rather than leaving the frameset or opening a new window, although hover is usually sufficient anyway.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<!--
						These lines, although commented, were breaking the minitool when pasting it into Konqueror:
						/**Failing in every way to highlight the loaded(ing) preview:**/
						/*
						linkNode.text = &quot;*&quot;+linkNode.text+&quot;*&quot;;
						linkNode.color = &quot;#eeee00&quot;;
						linkNode.parentNode.style = &quot;bgcolor = #ffff00;&quot;;
						linkNode.parentNode.style.bgcolor = &quot;#ffff00&quot;;
						*/
		-->
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.85 - Good!</LI>
		<BLOCKQUOTE>
				<!-- heh it was worth a bash :p
				<SCRIPT type='text/javascript'>
					document.write('Maybe you want the ');
					document.write('<A id="splitPreviewBookmarkletWithClickToBreakOut">Older version</A>.');
					document.getElementById('splitPreviewBookmarkletWithClickToBreakOut').href = escape(document.getElementById('splitPreviewBookmarklet').href.replace('target = &quot;previewFrame&quot;','target = &quot;_parent&quot;'));
				</SCRIPT>
				-->
			</P>
			<LI class='done'>In this version only, links from the left pane open in a new tab/window when clicked.</LI>
			<!-- When I am using the SplitPreview, I am very annoyed when I accidentally click and lose it!  In Konq, we need to reload the bookmarklet, we can't just 'go back'.. -->
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
						document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
						*/
						lastLoaded = linkNode;
						linkNode.text = &quot;WHEEE&quot;;
						/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
					document.links[i].target = &quot;_parent&quot;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** This works on Mozilla but not Konqueror. **/
			/*
			var scriptElement = window.frames[0].document.createElement('SCRIPT');
			scriptElement.type = 'text/javascript';
			scriptElement.innerHTML = scriptText;
			window.frames[0].document.documentElement.appendChild(scriptElement);
			*/
			/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
			/*window.frames[0].document.open();*/
			/** Prepending <pre> makes the text TT! **/
			/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
			/*
			oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
			*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.8</LI>
		<BLOCKQUOTE>
			<LI class='done'>In this version, clicking on a link causes it to open in the current tab, leaving the frameset.</LI>
		</BLOCKQUOTE>
	</P>

	<P>The only good thing about the initial IFrame implementations, is that we don&apos;t have to rebuild the DOM, we can successfully move the existing page inside the table.  The disadvantage is they they suck.  The sidebar needs a scrollbar too, but I couldn&apos;t successfully add the document into an IFrame.</P>

	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var f = document.createElement('IFRAME');
			f.id = 'myframe';
			f.width=window.innerWidth*55/100;
			f.height=window.innerHeight;
			d1.appendChild(document.documentElement);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+f.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			/* cheap and dirty close - should be right aligned, maybe a button with value X. */
			d2.appendChild(f);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview Prototype 0.4</A> - Poor
		<BLOCKQUOTE>
			<P>Instead of a floating IFrame, we split the view left/right and put the two panes inside a table.</P>
			<LI class='done'>Done: Using only onmouseover for hover detection is too sensitive.  We should also check: 1) user has hovered over the link for some time, and 2) the link being hovered on is not already loading!</LI>
			<LI class='done'>Done: Add Close button, to remove the floatingframe, and remove all the onmouseover events we added.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<!--
		
		DONE: Reloading the iframe every time we mouseover a link is a bit too much!
		We should at least check we aren't already loading this page, and that the user
		is hovering on our link, not just quickly passing over it to reach another.
		
		TODO: For real speed when flicking between previews, we should have 1 IFrame
		per link, but rotate/hide them so that only 1 is visible.  The background ones
		can load and be fast and ready.
		
		TODO: On Google, the floating IFrame does not appear where we desire.  This is
		consistent between Firefox and Konqueror!  Maybe we need to place the style tag
		in HTML rather than adding style prefs to the object.
		
		FIX: In Mozilla, our whole page gets replaced with '[object
		HTMLIFrameElement]', or whatever our last statement returns. The alert prevents
		it!
		
		-->
		<A href="
			javascript:(function(){
			var f = document.createElement('IFRAME');
			/* f.style = 'z-index:100'; */ /* breaks moz */
			f.align = 'left';
			/* f.src = 'blah.html'; */
			f.style.position = 'absolute';
			f.style.width = window.innerWidth * 3/4;
			f.style.height = window.innerHeight * 3/4;
			f.style.top = 20;
			f.style.right = 20;
			/* TODO: our lovely positioning breaks on google! */
			f.id = 'floatingFrame1';
			document.body.appendChild(f);
			function eventHandler(evt) {
				var linkNode = evt.currentTarget;
				document.getElementById('floatingFrame1').src = linkNode.href;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
			}
			})();
		">Popup Preview Prototype 0.3</A> - Poor
		<!-- Another workaround is to put the javascript in a button on the page.
		This does not suffer problem related to the return value.-->
		<!-- <INPUT type="button" value="Go" onclick=" -->
		<!-- "></INPUT> -->
		<BLOCKQUOTE>
			<P>Pops up a floating IFrame, where target pages are displayed when we hover over links on the current page.</P>
			<LI class='todo'>Bug: When invoked on Google result pages, the IFrame's floating style does not work properly - it sits at the bottom of the page.</LI>
			<LI class='todo'>Bug: It frequently covers up the links we want to hover over!</LI>
		</BLOCKQUOTE>
		<!--
		<div id='floatframe'>
			<iframe id='floatingFrame1' width='320' height='240' src='blah.html' align='left'> </iframe>
		</div>
		<style type="text/css">
			#floatframe {position:absolute;
				right:20px;
				top:20px;
				width:320px;
				height:240px;
				z-index:100;
			}
		</style>
		-->
	</P>

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			window.status = '1';
			/*d1.appendChild(document.documentElement);*/
			leftFrame.appendChild(document.documentElement);
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			d2.appendChild(rightFrame);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			/* leftFrame.src = document.location; */
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview New 0.1</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var target = document.location;
			document.open(); document.write('<HTML><BODY>bleh</BODY></HTML>'); document.close();
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			t.appendChild(r);
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			r.appendChild(d1);
			r.appendChild(d2);
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			d2.appendChild(rightFrame);
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			/*window.status = '1';*/
			/*d1.appendChild(document.documentElement);*/
			leftFrame.appendChild(document.documentElement);
			leftFrame.innerHTML = '<HTML><BODY>ffs</BODY></HTML>';
			/*leftFrame.src = target;*/
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview New 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var target = document.location;
			var oldHTML = document.documentElement.innerHTML;
			with(window.open(&quot;&quot;,&quot;_blank&quot;,&quot;width=&quot;+screen.width*.6+&quot;,left=&quot;+screen.width*.35+&quot;,height=&quot;+screen.height*.9+&quot;,resizable,scrollbars=yes&quot;)) {
				document.open();
				/*
				document.write('<HTML><BODY>\n');
				document.write('IFrame coming...<BR/>');
				document.write('<IFRAME>\n');
				document.write('Doc coming...<BR/>');
				oldHTML = oldHTML.replace(/%26/g,%27%26amp;%27).replace(/%3E/g,%27%26gt;%27).replace(/%3C/g,%27%26lt;%27);
				document.write(oldHTML);
				document.write('Doc done.<BR/>');
				document.write('</IFRAME>\n');
				document.write('IFrame done.<BR/>');
				document.write('</BODY></HTML>\n');
				*/
				document.write('<head><title>asdddd</title></head><frameset rows=&quot;25,*&quot;>\n');
				document.write('<frame name=&quot;leftFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
				document.write('<frame name=&quot;rightFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
				document.write('</frameset>\n');
				document.close();
				/*var text = document.createElement('DIV');
				text.innerHTML = '<BODY>HELLO</BODY>';*/
				/* document.getElementsByTagName('IFRAME')[0].appendChild(text); */
				/* document.getElementsByTagName('IFRAME')[0].write('<BODY>Hello</BODY>'); */
				frames[1].src = 'http://hwi.ath.cx/';
				frames[0].write('<HEAD>a frame</HEAD><BODY>Hello</BODY>');
				/* This throws an error, but it's what the PartialSource bookmarklet uses. */
			}
		})();">Split Preview New HTML 0.3</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			leftFrame.appendChild(document.documentElement);
			/* leftFrame.innerHTML = document.documentElement.innerHTML; */
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			/* cheap and dirty close - should be right aligned, maybe a button with value X. */
			d2.appendChild(rightFrame);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview Two IFrames 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('rightFrame').src = linkNode.href;
					/* document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text; */
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var frameset = document.createElement('FRAMESET');
			frameset.rows = '40%,*';
			var leftFrame = document.createElement('FRAME');
			var rightFrame = document.createElement('FRAME');
			frameset.appendChild(leftFrame);
			frameset.appendChild(rightFrame);
			rightFrame.id = 'rightFrame';
			/* leftFrame.src = 'http://hwi.ath.cx/'; */
			rightFrame.src = 'about:blank';
			leftFrame.appendChild(document.documentElement);
			/* document.open(); document.close(); */
			document.appendChild(frameset);
			document.doGet = doGet;
		})();">Split Preview Frames 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<LI><A href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;40%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
						document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
						*/
						lastLoaded = linkNode;
						linkNode.text = &quot;WHEEE&quot;;
						/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** This works on Mozilla but not Konqueror. **/
			/*
			var scriptElement = window.frames[0].document.createElement('SCRIPT');
			scriptElement.type = 'text/javascript';
			scriptElement.innerHTML = scriptText;
			window.frames[0].document.documentElement.appendChild(scriptElement);
			*/
			/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
			/*window.frames[0].document.open();*/
			/** Prepending <pre> makes the text TT! **/
			/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
			/*
			oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
			*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.79 - Good!</LI>
		<BLOCKQUOTE>
			<P>Splits the page, with the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.</P>
			<P><I>(Rejoice!  It was an effort but I nailed this critter.)</I></P>
			<LI class='todo'>Todo: Clicking on a link causes it to open in the sideFrame, but preferably the browser would drop the frames and go directly to the page.</LI>
		</BLOCKQUOTE>
	</P>
	-->

	<P>ShowWeb2: Show which elements have special events such as mouseOver etc.  In fact expose all elements with out-of-the-usual properties.</P>

</BLOCKQUOTE>

<STYLE type='text/css'>
	.todo {
		/*font-size: -1;*/
		color: #886644;
	}
	.done {
		color: #005500;
	}
	.external {
		/*color: #aa4400;*/
		color: #aaaa00;
	}
	.hiddenlink {
		color: #000000;
		text-decoration: none;
		cursor: crosshair;
	}
</STYLE>

<!--
Nice idea but it didn_t work.  It breaks all the bookmarklets!
<SCRIPT type='text/javascript'>
/*
var cnt = 0;
for (i=0;i<document.links.length;i++) {
	var link = document.links[i];
	if (link.href.indexOf('javascript:')==0) {
		cnt++;
		link.href = escape(link.href);
	}
}
document.writeln('<P>Escaped '+cnt+" bookmarklets.</P>");
*/
</SCRIPT>
-->

</BODY>
</HTML>
