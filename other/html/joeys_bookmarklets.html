<HTML>
<HEAD>
	<TITLE>Joey's Bookmarklet (Development) Page</TITLE>
	<!-- Keep viewer safe from infinte alert trap! -->
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/alert_watcher.user.js'></SCRIPT>
	<!--
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/ajaxslt-0.8.1/xmltoken.js'></SCRIPT>
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/ajaxslt-0.8.1/util.js'></SCRIPT>
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/ajaxslt-0.8.1/dom.js'></SCRIPT>
	<SCRIPT type='text/javascript' src='http://hwi.ath.cx/javascript/ajaxslt-0.8.1/xpath.js'></SCRIPT>
	-->
</HEAD>
<BODY>

<H2>Joey's Bookmarklet (Dev<A class='hiddenlink' href='#dev'>elopm</A>ent) Page</H2>

<DIV class='section'>
<H3>Introduction</H3>
<BLOCKQUOTE>

	<DIV>
		<P>
			This page contains bookmarklets which I have developed, and sometimes improve.
			<!-- Maybe misleading since some of the bookmarklets source external scripts. -->
			It was last updated <SCRIPT type='text/javascript'>document.write(document.lastModified);</SCRIPT>.
			(<A href="http://hwi.ath.cx/cgi-bin/cvsweb/other/html/joeys_bookmarklets.html">CV</A><A href="http://hwi.ath.cx/cgi-bin/viewcvs.cgi/other/html/joeys_bookmarklets.html">S</A>)
		</P>
		<P>Known bugs and TODOs are <font class='todo'>shown in orange</font>, changes and added features <font class='done'>in green</font>.</P>
		<P>For a big list of all my collected bookmarklets, along with a code viewer, visit:</P>
		<BLOCKQUOTE><A href='http://hwi.ath.cx/xslt/live/minitools/show_minitools.html'>Joey&apos;s Minitools/Bookmarklets</A></BLOCKQUOTE>
		<P>Bookmarklets are a bit like Bookmarks, but instead of taking you to a Web Page, they perform <I>useful actions</I> <B>on the page you are viewing</B>.</P>
		<P>Click on a bookmarklet below to try it out.  (Reload the page or navigate back if you don&apos;t like the results!)</P>
		<P>To copy a bookmarklet so you can use it later, drag the link to your Bookmarks Toolbar, or right-click to bookmark it.</P>
		<!-- <P class='external'>Bookmarklets marked in yellow do not contain all the code themselves, but load an external javascript file from hwi.ath.cx.  You rarely need to upgrade these bookmarklets because they are always loading the latest version.  But if I develop the script and break it, your bookmarklet may stop working.</P> -->
	</DIV>

</BLOCKQUOTE>
</DIV>

<DIV class='section'>
<H3>User Bookmarklets</H3>
<BLOCKQUOTE>

	<!-- I found by setting target='_self', the URL in my browser's location bar was not changed to the script text, which looked messy. -->

	<P>
		<LI><A href="javascript:(function(){
			var cnt = 0;
			function checkDoneLoading() {
				if (this.addFoldsToBlockQuotes != undefined) {
					window.status = 'Script loaded in '+(cnt*5)+'ms.';
					/*addFoldsToBlockQuotes();*/
					var tagTypes = new Array( 'ul', 'blockquote', 'dl', 'table' );
					/*addFoldsToPage(tagTypes,false);*/
					addFoldsToBlockQuotes();
				} else {
					window.status = 'Waiting for modifyDOM script to load... ('+(++cnt)*5+'ms)';
					setTimeout('top.checkDoneLoading();',5);
				}
			}
			top.checkDoneLoading = checkDoneLoading;
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/modifyDOM.js';
			/** Good method but acts twice since we are using other method for Konqueror. **/
			/* newScript.onload = checkDoneLoading; */
			document.getElementsByTagName('head')[0].appendChild(newScript);
			/** Konqueror needs this: **/
			setTimeout('top.checkDoneLoading();',5);
			/** TODO: Test this method with konq:
			* window.addEventListener(
			*   'load',
			*   function() { document.body.innerHTML = newBody; },
			*   true);
			**/
		})();" keyword="keywordInjected" description="descriptionInjected" title="Version 0.9">Enable Page Folding</A></LI>
	</P>
	<!-- Nasty - At one point, FF was reloading all the resources except mosifyDOM.js, which is the one I was changing!  I cleared my cache and it stopped doing it after that. -->
	<BLOCKQUOTE>
		<P>Makes parts of the page collapsable and expandable, for easier navigation through large (tree-structured) pages.</P>
		<P class='tip'>You can use this bookmarklet on any web page.  Just copy it to your Bookmarks/Favorites/Minitools, and run it when you need it.</P>
		<!-- <LI title="I had to fiddle the original solution, to get one that also worked with Konqueror.">This was my first Bookmarklet which loads an external javascript file.</LI> -->
		<!-- <LI class='done'>Fixed: If the item we decide to use as the handle is a link, clicking on it clicks the link, as well as collapsing/expanding the child block, which is undesirable.  The fix is that the user can open/close those folds now by hovering over the handle. Todo: Avoid the real cause of the problem, by making sure the fold handle image sits outside the link.</LI> -->
		 <LI>Currently collapses BLOCKQUOTEs, ULs and TABLEs.  Are there other tags it could collapse?  (Check the code, it's easy to add extra tags.)</LI>
		 <LI class='todo'>Shouldn&apos; it be collapsing all the text after each bookmarklet on this page?  (They are in blockquotes.)  Is it missing them because they contain so little, or because we have done the parent and lost track of the child?</LI>
		 <LI class='todo'>Bug: At the moment this tool only works well if the element we fold up has a short text-heading appearing just before it.  Not all pages are like this, so we need to adapt the algorithm to work over a wider range of pages.</LI>
		 <!-- <LI class='todo'>Bug: This version tries to find the text node immediately before the folding block, and assume that is a label.  That works well on some pages (such as this one) but not on all - some pages have blocks without any introduction text.  But if the block does have a header, and we don&quot;t use it as the label, that looks messy.  So we need to make a confident decision about whether we found a label or not.</LI> -->
		 <LI class='todo'>Todo: We could even create blocks to compress where there was no structure.  E.g. create a block between two HR tags, provided the text content in between is large.  Or in fact squash any blocks containing text, if the text is >=15% of the parent&apos;s text.</LI>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var scriptText = '<SCRIPT type=&quot;text/javascript&quot;>
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (linkNode.className == \'specialButton\')
							return;
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=\'#ffddff\';
						/* linkNode.parentNode.style.backgroundColor=\'#88ee88\'; */
						var colUp = linkNode.parentNode;
						while (colUp.getElementsByTagName(\'A\').length == 1) {
							colUp.style.backgroundColor=\'#ffbbff\';
							colUp = colUp.parentNode;
						}
						top.window.frames[1].location = linkNode.href;
						document.getElementById(\'closeSidebarLink\').href = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(\'doGet();\',700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					var linkElem = document.links[i];
					if (linkElem.className == \'specialButton\')
						continue;
					/*linkElem.target = \'_parent\';*/
					linkElem.target = \'previewFrame\';
					linkElem.onmouseover = eventHandler;
					linkElem.onmouseout = clearLinkNode;
					linkElem.onclick = eventHandler; /* Not really needed for navigation, since we have set target ok, but needed to update the highlight!  Unfortunately doesn_t succeed. :P */
				}
				/* Unfortunately on Google results, loads the fat Maps page: linkNode = document.links[2]; doGet(); */
			</SCRIPT>\n';
			/* Safer but slower: */ var getback = document.location;
			/* Faster but messy on various sites: var getback = 'javascript:top.document.write(top.frames[0].document.documentElement.innerHTML);'; */
			var header = '<P align=\'right\'>[ <A class=\'specialButton\' id=\'closeSidebarLink\' title=\'Note: You will lose any navigation you have performed in the other frame.\' target=\'_top\'>Close This Sidebar</A> | <A class=\'specialButton\' target=\'_top\' href=\''+getback+'\'>Close Other Frame</A> ]</P>\n';
			var oldHTML = document.documentElement.innerHTML;
			oldHTML = header + oldHTML + scriptText;
			/*if (i<=0) { alert('Failed to find the body tag!'); return; }
			if (oldHTML.indexOf(scriptText) < 0) { alert('Insert failed.'); return; }
			document.write(oldHTML); return;*/
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			document.close();
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
		})();">Split Preview</A> version 0.90</LI>
		<BLOCKQUOTE>
			<P>Splits the page, placing the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.  Great for quickly browsing search results.</P>
			<LI class='todo'>Note: This Bookmarklet does not work well on <I>this page</I>, because the links on this page are mostly bookmarklets, so do not point at pages we could preview.  At least the first and last links on the page should work for you.</LI>
			<LI class='done'>There are now two close buttons available to the user, one for each frame.</LI>
			<P class='todo'>Todo:</P>
			<BLOCKQUOTE>
				<LI class='todo'>Open the first link automatically.  <SPAN class='done'>I tried this and realised it&apos;s not always desirable. Google results&apos; first link is GoogleMaps with a big flash-app.</SPAN></LI>
				<LI class='todo'>Thin frame across the top of the two panes, containing all the buttons+options, including Next/Previous buttons.</LI>
				<LI class='todo'>Maybe also a squish/unsquish button for the sidebar (temporarily almost-maximize preview frame)?</LI>
				<LI class='todo'>Also might be nice to have 'MoveRightFrameToLeft' and also a back button for that feature.  This would describe a sort of history-tree-browsing way or surfing, somewhat similar to the early Gnome2 file-chooser.</LI>
				<LI class='todo'>Consider an alternative approach: forget the left frame, just have a thin top frame with all the links from the page presented as tabs, which open in the mainframe below.  We could even do this without frames, just a table and an IFrame (or a hidden stack/cache of IFrames).</LI>
				<LI class='todo'>Bug/Feature: By quickly clicking on a link then moving away, it is possible to leave the highlight behind on an earlier link.</LI>
				<LI class='todo'>Bug: If you click e.g. a &quot;Next&quot; link in the side-pane, that frame will navigate but you will lose the bookmarklet&apos;s functionality.  We might require a userscript to overcome this.</LI>
				<LI class='todo'>Some pages break out of frames.  I don&apos;t know how to prevent this.</LI>
				<LI class='todo'>Remove the hover?  Fix the sticky-hover bug?</LI>
			</BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/trim_elements.js';
			/* newScript.onload = (function(){ init(); }); */
			document.body.appendChild(newScript);
		})();">Trim to Search String</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Adds a search filter bar at the top of the page.  Hides all parts of the page except those matching your search expression.</P>
		<LI class='done'>Added a nice unpleasant green style, and Close and Clear buttons. </LI>
		<LI class='todo'>This is much faster in Konqueror than in Firefox.</LI>
		<LI class='todo'>Bug: Sometimes we are wanting to select certain rows from a table, but this implementation hides the other cells in the row, even if one cell matches.</LI>
		<LI class='todo'>Todo: The search expression is too simple, at the moment we perform an exact case-sensitive match.  We should allow multi-word search, and exclusion with &apos;-&apos;.</LI>
		<LI class='todo'>Todo: Add options: case-sensitive, search HTML (rather than text), keep neighbours.</LI>
		<LI class='todo'>Todo: Allow trimming by XPath expression.  This can be very useful to extract precise elements of the page (e.g. Headings), or just to test an XPath.  If we display results in a small window (not the doc itself), user can click on each to jump to that part of the page!  So user just needs to find an XPath matching the headings, then he has built an index/contents navigation-assisting sidebar.</LI>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A href="
			javascript:
			function attachClickListener(node,clickProcessor) {
				if (node.captureEvents) {
					node.captureEvents(Event.CLICK);
				}
				node.onmouseup = clickProcessor;
				if (node.style) {
					node.style.cursor = (clickProcessor?'crosshair':'');
				}
				var kids = node.childNodes;
				for (var i=0;i<kids.length;i++) {
					attachClickListener(kids[i],clickProcessor);
				}
			}
			function processClick(evt) {
				var node = evt.currentTarget;
				window.status = 'Removed '+node;
				attachClickListener(document,null);
				node.innerHTML='';
				node.parentNode.removeChild(node);
			}
			attachClickListener(document,processClick);
		">Nuke next item clicked</A></LI>
	<BLOCKQUOTE>
		<P>Waits for user click, and hides whatever element they clicked on from the page.</P>
		<LI class='todo'>Todo: Actually destroy the element!  This is more like a Zap script, setting style.display=&apos;none&apos;.</LI>
		<LI class='todo'>Todo: Add two icons to the page, one to turn off the bookmarklet, another to undo deletes (restore deleted elements from the Trash).</LI>
		<LI class='todo'>Todo: Add info about what was destroyed (e.g. display its XPath in the statusbar, or in Trash list).</LI>
		<LI class='todo'>Todo: The element we want to destroy might not have any exposed surface to click on, e.g. a FORM.  Maybe we can fatten out invisible/zero-size elements.  (E.g. mark each with a '.'s and give info on mouseover?)</LI>
	</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			var info = document.links.length+" links on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<document.links.length;i++) {
				var link = document.links[i];
				html += "<TR><TD><A href=\""+(link.href)+"\">"+(link.text)+"</A></TD><TD>"+(link.href)+"</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			document.open();
			document.write(html);
			document.close();
		'>Just the Links</A></LI>
		<BLOCKQUOTE>
			Displays a list of all the links in the page.
			<P class='todo'>(This works badly on this page because the hrefs are poorly formatted, but on most pages it works fine!)</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			var images = document.getElementsByTagName("IMG"),
					info = images.length+" images on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<images.length;i++) {
				var image = images[i];
				html += "<TR><TD align=\"center\">\n";
				html += "&lt;IMG src=\""+image.src+"\"&gt;<BR/>\n";
				html += "<A href=\""+image.src+"\">"+image.src+"</A>\n";
				html += "</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			/* var w = open().document; */
			var w = document;
			w.open();
			w.write(html);
			w.close();
		'>Just the Images</A></LI>
		<BLOCKQUOTE>
			Displays a list of all the images in the page.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_blank";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_blank";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at New Window</A></LI>
		<BLOCKQUOTE>
			Use this if you want the browser to open a new window when you click on a link or button.  (E.g. you want to use the search form, but you don't want to leave the current page.)
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_self";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_self";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at This Window</A></LI>
		<BLOCKQUOTE>
			Use this if you want the browser to stay in the current window when you click on a link or button.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			window.open('http://www.google.com/search?as_lq='+escape(document.location),'_blank');
		})();">Google for Pages that Link to This</A> (pops up in a new tab/window)</LI>
		<BLOCKQUOTE>
			<P>Finds other pages on the web which link to this page.</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var style = document.createElement('STYLE');
			style.innerHTML = '.favicon { padding-right: 4px; vertical-align: middle; }';
			document.getElementsByTagName('head')[0].appendChild(style);
			for (var i=0;i<document.links.length;i++) {
				var link = document.links[i];
				if (link.href.match('^javascript:') || link.href.match('^#')) {
					continue;
				}
				var host = link.href.replace(/^[^\/]*:\/\//,'').replace(/\/.*$/,'');
				if (host == document.location.host) {
					continue;
				}
				var img = document.createElement('IMG');
				img.src = 'http://'+host+'/favicon.ico';
				/*img.width = '16';
				img.height = '16';*/
				img.className = 'favicon';
				link.parentNode.insertBefore(img,link);
			}
		})();">Faviconize External Links</A></LI>
		<BLOCKQUOTE>
			<P>Adds the favicon of the host server next to every external link on the page.</P>
			<P>I was recommended to consider also host/favicon.png but I saw none of these so stuck with .ico.</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			function killFonts(node) {
				if (node.tagName == 'FONT' || node.tagName == 'font') {
					if (node.face) {
						/* for (var child in node.childNodes) {
							node.parentNode.insertBefore(child,node);
						}
						node.parentNode.removeChild(node); */
						node.face = '';
					} /* otherwise leave the tag alone - it is harmless. */
				}
				if (node.style) {
					if (node.style.font) {
						node.style.font = '';
					}
					if (node.style.fontFamily) {
						node.style.fontFamily = '';
					}
				}
				for (var child in node.childNodes) {
					killFonts(child);
				}
			}
			/* check css... */
			if (document.styleSheets) {
				for (var i=0;i<document.styleSheets.length;i++) {
					var rules = document.styleSheets[i].cssRules;
					for (var j=0;j<rules.length;j++) {
						var rule = rules[j];
						if (rule.style) {
							if (rule.style.font) {
								rule.style.font = '';
							}
							if (rule.style.fontFamily) {
								rule.style.fontFamily = '';
							}
						}
					}
				}
			}
			killFonts(document.body);
			window.document.status = 'All fonts cleared.';
		})();">Kill All Fonts</A></LI>
		<BLOCKQUOTE>
			<P>For when you would prefer the fonts you specified in your browser over than the ones specified by the page.</P>
			<LI class='todo'>Todo: Convert known faces to sensible choice.  E.g. if the document specifies a fixed-width font we recognise, then convert the font to our favourite fixed-width font, and not a serif font.</LI>
		</BLOCKQUOTE>
	</P>

</BLOCKQUOTE>

</DIV>

<DIV class='section'>
<H3>Web-Developer Bookmarklets</H3>
<BLOCKQUOTE>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				node.onmouseover = doHighlight;
				node.onmouseout  = undoHighlight;
				/*
				var xpath = getXPath(node);
				if (node.style) {
					node.style.backgroundColor = '#' + getColorFor(simplexpath);
				}
				node.title = simplexpath;
				*/
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+39357) %25 52597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				/*if (Math.floor(Math.random()*6) == 5) {
					window.status = 'Did parseInt for \''+obj+'\' hash='+hash+' and got hex='+hex;
				}*/
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function getAttribs(node) {
				var attribs = '';
				for (var j=0;j<node.attributes.length;j++) {
					var attr = node.attributes[j];
					if (attr.name == 'title') { continue; }
					attribs += ' ' + attr.name + '=&quot;' + attr.value.replace(/&quot;/g,'%22') + '&quot;';
				}
				return attribs;
			}
			function getCSS(node) {
				/** In Konq, getComputedStyle produces empty cssText, and too many
				    attribs, unless we can strip out those with default values. **/
				/*var css = getComputedStyle(node,'');*/
				var css = node.style;
				var out = '';
				/*for (i in css) {*/
				for (var i=0;i<css.length;i++) {
					if (typeof(css[i])=='function') { continue; }
					/* Solved by changing after! if (css[i] == 'background-color') { continue; } */ /*Works for Konq, but in Moz bgcol is part of style attrib.*/
					out += css[i] + '=' + css.getAttribute(css[i]) + ' ';
					/* getAttribute and getPropertyValue are not returning what we need in Konq! */
				}
				return css.cssText; /*strip bgcol*/
				return out;
			}
			function doHighlight(evt) {
				var node = evt.currentTarget; /* try evt.srcElement if this fails. */
				var xpath = getXPath(node);
				/* Did not work: var simplexpath = xpath.replace(/\[[^]]*\]/g,''); */
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.tagName!='HTML' && node.tagName!='BODY') {
					var attribs = getAttribs(node);
					node.title = xpath + '\n\n' + '  <'+node.tagName+attribs+'/>' + '\n\n' + '  '+getCSS(node);
					if (node.style) {
						node.style.backgroundColor = '#' + getColorFor(simplexpath);
					}
				}
				/** This might display the xpath of elements which don't display their title but can be rolled over. **/
				if (firstEvent) {
					firstEvent = false;
					/* Do whatever it is we want to do only on the topmost element. */
					window.status = xpath;
				} else {
					/*if (xpath == '/html') {*/
					if (node.tagName=='HTML' || node.tagName=='BODY') {
						firstEvent = true;
					}
				}
			}
			function undoHighlight(evt) {
				var node = evt.currentTarget;
				node.style.backgroundColor = '';
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.tagName == node.tagName) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				var extra = '';
				/* if (node.id) {
					extra = '[@id=\''+node.id+'\']';
				} */
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' ) + extra;
			}
			processNode(document.body);
		})();">Highlight Structure</A> - Live Updates (Extra Info)</LI>
		<BLOCKQUOTE>
			<P>Colours the background of every element in the document according to its path.</P>
			<P>Displays the XPath of the focused element as a popup (sets title attribute).</P>
			<P>Useful when using Nuke, to find the element you really need to kill. <SPAN class='todo'>Todo: Include Highlight Structure in Nuke automatically.</SPAN></P>
			<LI class='done'>More useful for developers: as well as showing the XPath, we now also show the attributes of the element in its title/popup.</LI>
			<LI class='done'>Added tag and attributes to title.  Too bad the newlines don&apos;t work in the fox.</LI>
			<LI class='done'>Added limited CSS info to title.</LI>
			<LI class='todo'>The current &quot;webdeveloper&quot; version is psychedelic but informative.  We might want to make a friendlier few-colour version, for common browsing usage.  Example usage: The structure of this page (and some others on the web), whilst tree-like, is not immediately intuitive.  However if we were to set the background of all level 1 DIVs to green, and level 2 DIVs to blue, and level 3 BLOCKQUOTES to orange, etc., the page might be easier to navigate.</LI>
			<LI class='todo'>Can be sluggish to run on the heavier DOMs.</LI>
			<LI class='todo'>It acts on every element you move the mouse over, which can be a lot.  It could take a break while you move, if it doesn&apos;t highlight newly entered elements, it won&apos;t have to unhighlight them on the way out.</LI>
			<LI class='todo'>Part of the problem is that a mouselistener is added to every element in the DOM, when we should just capture using the body element.</LI>
			<LI class='todo'>Adapt the colour generator to produce pastels only.</LI>
			<LI class='todo'>Rather than use the browser&quot;s default popup for title tag when hovering over elements, we could use our own custom popup.  This could give 2 advantages: 1) we could make newlines work in Mozilla; 2) By keeping the popup ever-present, the user can easily see when the XPath switches by a little or a lot.  The XPath in Konqueror&apos;s statusbar almost does this, but when hovering over a link it gets hidden.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				node.onmouseover = doHighlight;
				node.onmouseout  = undoHighlight;
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+39357) %25 52597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function doHighlight(evt) {
				var node = evt.currentTarget;
				var xpath = getXPath(node);
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.tagName!='HTML' && node.tagName!='BODY') {
					node.title = xpath;
					if (node.style) {
						node.style.backgroundColor = '#' + getColorFor(simplexpath);
					}
				}
				if (firstEvent) {
					firstEvent = false;
					window.status = xpath;
				} else {
					if (node.tagName=='HTML' || node.tagName=='BODY') {
						firstEvent = true;
					}
				}
			}
			function undoHighlight(evt) {
				var node = evt.currentTarget;
				node.style.backgroundColor = 'white';
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.tagName == node.tagName) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' );
			}
			processNode(document.body);
		})();">Highlight Structure</A> - Live Updates (Less Info)</LI>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				var xpath = getXPath(node);
				var simplexpath = xpath.replace(/[0-9]*/g,'');
				if (node.style) {
					node.style.backgroundColor = '#' + getColorFor(simplexpath);
				}
				node.title = simplexpath;
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+393457) %25 572597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.tagName == node.tagName) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' );
			}
			processNode(document.body);
		})();">Highlight Structure</A> - All In One Go</LI>
		<BLOCKQUOTE>
			<P>A modified version which does all the colouring in one go.</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var firstEvent = true;
			function processNode(node) {
				for (var i=0;i<node.childNodes.length;i++) {
					processNode(node.childNodes.item(i));
				}
				var xpath = getXPath(node);
				var simplexpath = xpath.substring(xpath.lastIndexOf('/')).replace(/[0-9]*/g,'');
				if (node.style) {
					node.style.backgroundColor = '#' + getColorFor(simplexpath);
				}
				node.title = simplexpath;
			}
			function getColorFor(obj) {
				var s = ''+obj;
				var hash = 0;
				for (i=0;i<s.length;i++) {
					hash += ((i+39357) %25 52597)*s.charCodeAt(i);
					hash = hash % 16777216;
				}
				var hex = hash.toString(16);
				/*if (Math.floor(Math.random()*6) == 5) {
					window.status = 'Did parseInt for \''+obj+'\' hash='+hash+' and got hex='+hex;
				}*/
				if (hex.length>6) hex=hex.substring(0,6);
				while (hex.length<6) { hex='0'+hex; }
				return hex;
			}
			function getXPath(node) {
				var parent = node.parentNode;
				if (!parent) {
					return '';
				}
				var siblings = parent.childNodes;
				var totalCount = 0;
				var thisCount = -1;
				for (var i=0;i<siblings.length;i++) {
					var sibling = siblings[i];
					if (sibling.tagName == node.tagName) {
						totalCount++;
					}
					if (sibling == node) {
						thisCount = totalCount;
					}
				}
				return getXPath(parent) + '/' + node.nodeName.toLowerCase() + (totalCount>1 %3F '[' + thisCount + ']' : '' );
			}
			processNode(document.body);
		})();">Highlight Structure</A> - Sober</LI>
		<BLOCKQUOTE>
			<P>Fewer colours (same tags have the same colour, no matter the depth), but still too much contrast.</P>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="
			javascript:(function(){
				theForm = document.forms[0];
				theStr = '';
				for (i=0; i < theForm.elements.length; i++) {
					ele = theForm.elements[i];
					theStr += ele.name + ' : ' + ele.value + '\n';
				}
				alert (theStr);
			})();
		">Show Form Data</A></LI>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			document.runCmd =
				function runCmd(cmd) {
					var result;
					try {
						result = ''+eval(cmd);
					} catch (e) {
						result = 'Error: '+e;
					}
					/*document.getElementById('qconsOut').innerHTML = escape(result);*/
					document.getElementById('qconsOut').value = (result);
				};
			window.inspect =
				function inspect(o) {
					var result;
					result = '';
					for (var i in o) {
						result = result + i + ', ';
					}
					return result;
				};
			window.loadScript =
				function loadScript(url) {
					var newScript = document.createElement('SCRIPT');
					newScript.type = 'text/javascript';
					newScript.src = url;
					/*document.body.appendChild(newScript);*/
					document.getElementsByTagName('head')[0].appendChild(newScript);
				};
			function checkKey(evt) {
				if (evt.keyCode == 27) {
					closeQuickConsole();
				}
			}
			function closeQuickConsole() {
				myDiv.parentNode.removeChild(myDiv);
				myStyle.parentNode.removeChild(myStyle);
			}
			var myDiv = document.createElement('div');
			myDiv.setAttribute('class','qcons');
			/* &lt;IFRAME width=\'100%\' height=\'50px\'/&gt;\n */
			/* &lt;P id=\'qconsOut\'&gt;&lt;/P&gt;\n */
			/* &lt;B&gt;qCons:&lt;/&gt; */
			myDiv.innerHTML = '
				&lt;FONT size=\'-2\'&gt;
				&lt;TEXTAREA rows=\'5\' cols=\'100\' id=\'qconsOut\' readonly&gt;&lt;/TEXTAREA&gt;\n
				[&lt;A href=\'javascript:(function(){myDiv.parentNode.removeChild(myDiv); myStyle.parentNode.removeChild(myStyle);})();\' title=\'\'>X&lt;/A&gt;]\n
				&lt;/FONT&gt;
				&lt;BR/&gt;
				&lt;INPUT type=\'text\' name=\'cmd\' value=\'\' size=\'100\' onchange=\'if (value) { runCmd(value); }\'/&gt;\n
			';
			/* FAIL (style has no setter): myDiv.style = '{ position: color: red; fixed; bottom: 8px; z-index: 10000; }'; */
			var myStyle = document.createElement('style');
			myStyle.setAttribute('type','text/css');
			/* Works for Moz: */
			myStyle.innerHTML = 'div.qcons { color: white; background-color: #44aa44; position: fixed; left: 2px; right: 2px; bottom: 2px; z-index: 10000; text-align: center; padding: 4px; border: 1px solid #000000; }';
			/* Works for Konq: */
			var x;
			if (myDiv.style.setAttribute) {
				x = myDiv.style;
				x.setAttribute('color','white');
				x.setAttribute('background-color','#44aa44');
				x.setAttribute('padding','8px');
				x.setAttribute('position','fixed');
				x.setAttribute('left','2px');
				x.setAttribute('right','2px');
				x.setAttribute('bottom','2px');
				x.setAttribute('z-index','10000');
				x.setAttribute('text-align','center'); /* TODO konq fail */
				x.setAttribute('padding','4px');
				x.setAttribute('border','2px solid black');
			}
			myDiv.onkeypress = checkKey;
			document.documentElement.appendChild(myStyle);
			document.documentElement.appendChild(myDiv);
			document.body.style.marginBottom = '110px';
			/* Give access to the Close link: */
			top.myDiv = myDiv;
			top.myStyle = myStyle;
			myDiv.getElementsByTagName('INPUT')[0].focus();
		})();">Quick Javascript Console</A> - Yet another</LI>
	</P>
	<BLOCKQUOTE>
		<P>Well I had to make my own of course!</P>
		<LI class='done'>Closes on Escape key (Mozilla only I think).  It&quot;s working when focused on the input box, but not .</LI>
		<LI class='done'>Added user convenience functions <TT>inspect(obj)</TT> and <TT>loadScript(url)</TT>.</LI>
		<LI class='todo'>Todo: Close button is in the wrong place.</LI>
		<LI class='todo'>Todo: It would be groovy if both boxes worked the same, on the other.  So you can choose which box to edit in depending if you have big code producing little output, or little code producing big output.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			/*
			var libScript = document.createElement('script');
			libScript.type = 'text/javascript';
			libScript.src = 'http://hwi.ath.cx/javascript/xpath.js';
			document.body.appendChild(libScript);
			*/
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/xpath_tester.js';
			document.body.appendChild(newScript);
		})();">XPath Tester</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Loads a little XPath testing tool which will show you the results of your xpath query.</P>
		<LI class='todo'>I thought I had a pure Javascript implementation of XPathResult which would work for Konqueror, but I didn&apos;t.  ajaxslt looks pretty promising though.</LI>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

</BLOCKQUOTE>
</DIV>

<DIV class='section'>
<H3 id='dev'>Bookmarklets under Construction</H3>
<BLOCKQUOTE>

	<!--
	<H3>Testing Bookmarklets</H3>
	<BLOCKQUOTE>
		<P>The bookmarklets in this section are IN DEVELOPMENT!  You probably don't want to try using them just yet.  Go for the Ready to use Bookmarklets instead.</P>
	</BLOCKQUOTE>
	<SCRIPT type='text/javascript'> document.getElementsByTagName('BLOCKQUOTE')[0].style.backgroundColor='#cc8888'; </SCRIPT>
	-->
	<!-- I didn't feel like making a css class for that one-off. ;p -->

	<!-- <P>No bookmarklet in development on this page right now.  You probably wouldn't want to use it if it was. -->
	<!-- I might even consider separating my development and release pages. --></P>

	These are Bookmarklets I am still working on.  They may or may not work.

	<P>
		<LI><A href="javascript:(function(){
			if (this.selectElementForMoving) {
				/* Toggle off */
				document.body.removeEventListener('mousedown',selectElementForMoving,true);
				this.selectElementForMoving = null;
			} else {
				this.selectElementForMoving = function(evt) {
					var node = evt.target;
					node.style.position = 'fixed';
					if (!node.style.left && !node.style.right)
						node.style.left = evt.pageX - 32 - document.body.scrollLeft;
					if (!node.style.top && !node.style.bottom)
						node.style.top = evt.pageY - 32 - document.body.scrollTop;
					makeMoveable(node);
				};
				var newScript = document.createElement('script');
				newScript.type = 'text/javascript';
				newScript.src = 'http://hwi.ath.cx/javascript/make_elements_moveable.js';
				document.body.appendChild(newScript);
				document.body.addEventListener('mousedown',selectElementForMoving,true);
			}
		})();">Move Things Around</A></LI>
		<BLOCKQUOTE>
			<P>Allows you to move parts of the page around.</P>
			<LI>
				<SPAN class="done">Re-run the bookmarklet to stop it.</SPAN>
				<SPAN class="todo">Beware that won&apos;t be possible by clicking on this page!</SPAN>
			</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var scriptText = '<SCRIPT type=&quot;text/javascript&quot;>
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (linkNode.className == \'specialButton\')
							return;
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=\'#ffbbff\';
						/* linkNode.parentNode.style.backgroundColor=\'#88ee88\'; */
						var colUp = linkNode.parentNode;
						while (colUp.getElementsByTagName(\'A\').length == 1) {
							colUp.style.backgroundColor=\'#ee88ee\';
							colUp = colUp.parentNode;
						}
						top.window.frames[1].location = linkNode.href;
						document.getElementById(\'closeSidebarLink\').href = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(\'doGet();\',700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					var linkElem = document.links[i];
					if (linkElem.className == \'specialButton\')
						continue;
					/*linkElem.target = \'_parent\';*/
					linkElem.target = \'previewFrame\';
					linkElem.onmouseover = eventHandler;
					linkElem.onmouseout = clearLinkNode;
					linkElem.onclick = eventHandler; /* Not really needed for navigation, since we have set target ok, but needed to update the highlight!  Unfortunately doesn_t succeed. :P */
				}
				var lastWidth = 0;
				function toggleSideBar() {
					/** TODO: we should make everything in the sidebar, except for the toggle bar, invisible! **/
					/** TODO: On Konqueror, repeated toggling makes the frame smaller.  On Mozilla it works perfectly already. **/
					/** TODO: Need better style to fix the width of the toggleBar. **/
					if (lastWidth == 0) {
						top.window.frames[0].document.getElementById(\'rightRow\').style.display = \'none\';
						/*top.window.frames[0].document.getElementById(\'header\').style.display = \'none\';*/
						lastWidth = top.window.frames[0].window.innerWidth;
						/*alert(\'toggling!\');*/
						top.document.body.cols = \'32,*\';
						/*alert(\'cols = \'+top.document.body.cols);*/
						window.frames[0].document.getElementById(\'leftRow\').style.width = \'2px\';
					} else {
						top.document.body.cols = lastWidth + \',*\';
						lastWidth = 0;
						top.window.frames[0].document.getElementById(\'rightRow\').style.display = \'\';
						/*top.window.frames[0].document.getElementById(\'header\').style.display = \'\';*/
						window.frames[0].document.getElementById(\'leftRow\').style.width = \'18px\';
					}
				}
				/* Unfortunately on Google results, loads the fat Maps page: linkNode = document.links[3]; doGet(); */
			</SCRIPT>\n';
			var toggler = '<A class=\'specialButton\' href=\'javascript:toggleSideBar();\'>Collapse</A> | ';
			/* Safer but slower: */ var getback = document.location;
			/* Faster but messy on various sites: var getback = 'javascript:top.document.write(top.frames[0].document.documentElement.innerHTML);'; */
			var header = '<P id=\'header\' align=\'right\'>[ ' + toggler + ' <A class=\'specialButton\' target=\'_top\' href=\''+getback+'\'>Restore</A> | <A class=\'specialButton\' id=\'closeSidebarLink\' target=\'_top\'>Close</A> ]</P>\n';
			var oldHTML = document.documentElement.innerHTML;
			oldHTML =
				'<TABLE cellpadding=\'4\'><TR><TD id=\'leftRow\' onclick=\'javascript:toggleSideBar();\' bgcolor=\'#aaaaff\' width=\'4px\' style=\'cursor:w-resize\'></TD><TD id=\'rightRow\' width=\'200px\'>\n'
				+ header
				+ oldHTML
				+ '</TD></TR></TABLE>\n'
				+ scriptText;
			/*if (i<=0) { alert('Failed to find the body tag!'); return; }
			if (oldHTML.indexOf(scriptText) < 0) { alert('Insert failed.'); return; }
			document.write(oldHTML); return;*/
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;400px,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			document.close();
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			window.frames[0].document.getElementById('header').style.position = 'absolute';
			window.frames[0].document.getElementById('header').style.top = '5px';
			window.frames[0].document.getElementById('header').style.right = '8px';
			/* window.frames[0].document.getElementById('header').style.setAttribute('z-index',100); */
			window.frames[0].document.getElementById('leftRow').style.width = '2px';
			/*window.frames[0].document.getElementById('leftRow').style.height = '100%2525';*/
			window.frames[0].document.getElementById('leftRow').style.height = top.window.innerHeight - 24;
		})();">Split Preview</A> version 0.89 DEV - Toggle</LI>
		<BLOCKQUOTE>
			<P>Splits the page, placing the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.</P>
			<LI class='done'>This version provides a 'Togglebar' to flatten/unflatten the sidebar.</LI>
			<LI class='todo'>It's working quite OK in Firefox, but a bit messily in Konqueror.</LI>
			<LI class='todo'>The ToggleBar should change height if the user resizes the window.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			function maxWidthList(l) {
				for (var i=0;i&lt;l.length;i++) {
					var n = l.item(i);
					if (n.width) {
						n.width = '100%';
					}
				}
			}
			function widenStyleList(l) {
				for (var i=0;i&lt;l.length;i++) {
					var n = l.item(i);
					widenStyle(n);
				}
			}
			function widenStyle(n) {
				if (n.style && n.style.width) {
					var w = parseInt(n.style.width);
					if (w&gt;500 && w&lt;1024) {
						/*n.style.width = '100%';*/
						n.style.width = 'auto';
					}
				}
			}
			function doAll(node) {
				if (node.style) {
					widenStyle(node);
				}
				for (var i=0;i<node.childNodes.length;i++) {
					doAll(node.childNodes.item(i));
				}
			}
			maxWidthList(document.body.getElementsByTagName('TABLE'));
			maxWidthList(document.body.getElementsByTagName('TR'));
			maxWidthList(document.body.getElementsByTagName('TD'));
			/*widenStyleList(document.body.getElementsByTagName('DIV'));
			widenStyleList(document.body.getElementsByTagName('SPAN'));*/
			doAll(document.body);
			if (document.styleSheets) {
				for (var i=0;i<document.styleSheets.length;i++) {
					var rules = document.styleSheets[i].cssRules;
					for (var j=0;j<rules.length;j++) {
						var rule = rules[j];
						widenStyle(rule);
					}
				}
			}
		})();">Widen Tables etc.</A></LI>
		<BLOCKQUOTE>
			<P>Releases some CSS and HTML width constraints, so fixed-width pages will expand horizontally to fill your screen.</P>
			<P class='todo'>It is quite hard to construct an algorithm that will work on a wide range of pages.  It is easy to destroy CSS that was preventing overlapping for example.  I don&apos;t know enough about the different ways CSS is used to really attempt this properly.  My primitive attempt remains here until I find a better one!</P>
			<LI class='done'>Done: Apart from tables, there are divs with fixed width, controlled by their css style.  e.g. &lt;div style=&quot;width: 710px;&quot;&gt;</LI>
			<LI class='done'>Seems we must check all the CSS styles, not only those associated with elements.</LI>
			<LI class='done'>Current implementation only works on widths which have been given specified width between 500 and 1024px.</LI>
			<LI class='todo'>We don&apos;t yet detect width=&quot;90%&quot; - we see that as 90px and skip it.</LI>
			<LI class='done'>Set css widths to &quot;auto&quot; rather than &quot;100%&quot;.</LI>
			<LI class='todo'>Deal with elements that are too thin because they have a large margin or padding css setting.</LI>
			<LI class='todo'>Bah CSS smells.  Some pages I just can&apos;t fix without manual tweaking.  Setting all widths to &apos;auto&apos; will sometimes cause things to not fit well together.</LI>
			<LI class='todo'>Consider: Maybe better to set table/cell/row widths to &quot;&quot; (aka auto) rather than &quot;100%&quot;.</LI>
			<LI class='todo'>Todo: Fine if you have a big browser.  But the Bookmarklet should also make an effort to help, if your screen size is small.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			function checkDoneLoading() {
				if (this.powerbar_init != undefined) {
					window.status = '';
					powerbar_init();
				} else {
					window.status = 'Waiting for add_powerbar script to load.';
					setTimeout('top.checkDoneLoading();',100);
				}
			}
			top.checkDoneLoading = checkDoneLoading;
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/add_powerbar.js';
			/** This method works for Mozilla but not Konqueror: **/
			/* newScript.onload = (function(){ powerbar_init(); }); */
			/* newScript.onload = checkDoneLoading; */
			/*newScript.onload = checkDoneLoading;*/
			/*document.getElementsByTagName('head')[0].appendChild(newScript);*/
			document.getElementsByTagName('head')[0].appendChild(newScript);
			/* no: document.body.appendChild(newScript); */
			/** Konqueror requires this method: **/
			/*setTimeout('top.checkDoneLoading();',50);*/
			/*setTimeout('powerbar_init();',5000);*/
			/*setTimeout('try {powerbar_init();} catch (e) { alert(e); }',5000);*/
		})();">Load Powerbar</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>My monstrous old web test environment, almost working through a bookmarklet!</P>
		<LI class='external'>Note: Loads external script.</LI>
	</BLOCKQUOTE>

	<P>
		<LI><A href="javascript:(function(){
			function togglePreview(evt) {
				var hit = evt.currentTarget;
				var link = hit.nextSibling;
				if (link.href) {
					/*var newNode = document.createElement('P');*/
					var newIFrame = document.createElement('IFRAME');
					newIFrame.src = link.href;
					newIFrame.width = '100%';
					newIFrame.height = '320';
					hit.parentNode.insertBefore(newIFrame,hit.nextSibling);
				} else {
					window.status = 'togglePreview() Failed to find link sibling '+link+' for '+hit;
				}
			}
			/*for (var link in document.getElementsByTagName('A')) {*/
			for (i=0;i<document.links.length;i++) {
				var link = document.links[i];
				var newNode = document.createElement('SPAN');
				newNode.innerHTML = '<IMG src=\'http://hwi.ath.cx/images/plus.png\'/>\n';
				link.parentNode.insertBefore(newNode,link);
				newNode.onclick = togglePreview;
			}
		})();">Inline Preview</A> - an alternative approach if you didn't like Split Preview.</LI>
		<BLOCKQUOTE>
			<P>Adds a 'preview' to each link, to open it 'inline' in an IFrame.</P>
			<LI class='todo'>Alternatively to clicking, show popup preview on hover.</LI>
			<LI class='todo'>Very initial implementation (PoC).</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/friendly_preview.js';
			document.documentElement.getElementsByTagName('HEAD')[0].appendChild(newScript);
		})();">Friendly Preview</A></LI>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target="_self" href="javascript:(function(){
			alert('TODO');
		})();">Turn this page into a drop-down.</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Generates a Bookmarklet which when invoked later offers a drop down menu of:</P>
		<BLOCKQUOTE>
			<LI>Opening the original page.</LI>
			<LI>All the links on the original page.  (Maybe those links were bookmarklets ^^.  Optional: generate menu in tree, according to page.)</LI>
			<LI>In other words, I intend to run this script on my Minitools (collected bookmarklets) page, to generate a bookmarklet which contains all of them in a menu.  :)</LI>
		</BLOCKQUOTE>
		<P>Maybe it isn&apos;t an immediate drop-down menu, but it sits as an icon until clicked.</P>
		<P>If the user wants to keep it alive, we will need to keep our functions safe in a different frame.  But in that case all the bookmarks will need to be retargetted at the relevant frame.</P>
	</BLOCKQUOTE>

	<P>
		<LI><A href="javascript:(function(){
			...
		})();">Wordify</A> (Generate Tag Cloud)</LI>
		<BLOCKQUOTE>
			...
		</BLOCKQUOTE>
	</P>

</BLOCKQUOTE>
</DIV>

<DIV class='section'>
<H3>Wanted / TODO</H3>
<BLOCKQUOTE class='todo'>

	<P>I introduced a different loading technique for all the external loading scripts that don&apos;t auto-init, so that they work with Konqueror.  (Such scripts are more powerful since they can be loaded as libraries, although it&apos;s not essential: we could create scripts which call their own init() function.)  Some of these bookmarklets would be smaller/neater without the Konqueror support.  The compatibility of my loading technique has not been tested on other browsers.</P>

	<P>
		<LI><A href="" title="Version 0.9">Auto Highlight</A></LI>
	</P>
	<BLOCKQUOTE>
		<P>Checks document.location AND document.referrer and if the CGI contains a search expression, assume this is a result page, and highlight the search terms.</P>
	</BLOCKQUOTE>

	<P>TODO: Userscript that does: if target of link is an image, on mouseover, load image in popup iframe</P>

	<P>
		MakeABookmarkletFromTheSearchFormOnThisPage ^^
	</P>

	<P>
		To help page investigation, colour every element (a bit like XPathGrabber does).
		And when we mouseover an element, show which one it is in the StatusBar (e.g. show it's XPath, since colour won't be possible in the StatusBar)p.
	</P>

	<P>
		Something similar to Preview Links in FloatingFrame, but instead split
		the window into two frames, put the current page in the left frame, and
		make all its links open the page in the right frame (when clicked, or
		hovered).
		It would be desirable to allow the split to be resized by the user.
		Also, be able to close the sideframe, or close the main frame.
	</P>

	<P>
		If I am viewing a page which is the result of a Google search, I may decide that the page is useless, and want to view another result.
		It would be great if the page could have a little icon added, which on hover would show the other search results, and let me switch to one of them.
		We may be able to use Referrer to determine if this page was obtained from a search-results page.  (Although actually, we could consider 'any' page as a 'list-of-links', we don't have to restrict this feature to search-result pages only.)
	</P>

	<P>
	<A href='javascript:
		'>Invisibly preload links when I mouseover them</A>
	<BLOCKQUOTE>
		Sometimes I am reading a page but I know where I am likely to go next.
		If I can preload that page then when I do follow the link, it will load fast when I do click.
	</BLOCKQUOTE>
	</P>

	<P>
		StripSearch.  Hides all elements except those containing the search text.  Ideal for tables.
	</P>

	<P>BatchNuke (aka BatchSelect*-1): User is given text box to enter an XPath.  (He can get xpath hints by mouseover the document.)  As he types the XPath, elements of the page are hidden, until he finds the XPath he wants.  Then he hits enter, they are permanently hidden/destroyed, and he can enter another XPath if he wishes.</P>

	<LI class='done'>Done: JavascriptConsole: Konqueror does not accept javascript: commands in the location bar.  How can I run little snippets of javascript on the page?  This Bookmarklet should popup a floating IFrame with a textarea where the user can edit and execute Javascript, and close it when finished.  For debugging but also for power-processing of pages.  (We may wish to append/include external .js files.)</LI>

	<P>Bookmarklets and Framesets do not mix well.  Most Bookmarklets will try to target the frameset document rather than the child frame we are trying to focus on.  It would be nice to have a generic solution to this.</P>

	<P>Add Kill Column to Sort Table.</P>

	<P>Show Web 2.0: Show which elements have special events such as mouseOver etc.  In fact expose all elements with out-of-the-usual properties.  Limit to: javascript, css, URLs, other, ...</P>

	<P>Some of these bookmarklets are setting events on <I>every element in the DOM</I> in order to capture them (and then having to do tricks to only capture the top event fired!).  I believe using addEventListener() should allow us to capture all events, and the element on which each event occurred on.</P>

</BLOCKQUOTE>
</DIV>

<DIV class='section'>
<H3>Older Versions</H3>
<BLOCKQUOTE>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded,lastbgcol;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						if (lastLoaded) {
							lastLoaded.style.backgroundColor = lastbgcol;
							lastLoaded.parentNode.style.backgroundColor = lastbgcol;
						}
						lastLoaded = linkNode;
						lastbgcol = linkNode.style.backgroundColor;
						linkNode.style.backgroundColor=&quot;#ffff44&quot;;
						linkNode.parentNode.style.backgroundColor=&quot;#ffffbb&quot;;
						top.window.frames[1].location = linkNode.href;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				/** This can cause a document overwrite when on Google results pages. **/
				/*document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);*/
			';
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.87</LI>
		<BLOCKQUOTE>
			<LI class='done'>Now highlighting the link which is being previewed.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						/*var rightFrame = top.document.getElementById(&quot;previewFrame&quot;);*/
						/*top.window.frames[1].document.documentElement.innerHTML = ... ;*/
						top.window.frames[1].document.write(&quot;&lt;BODY&gt;Loading &quot;+linkNode.href+&quot;...&lt;/BODY&gt;&quot;);
						/** Writing to the frame above causes the line below to fail in Konqueror. **/
						/** One fix might be to embed some javascript inside the body we just posted, to redirect the frame/page/doc. **/
						/*top.window.frames[1].src = linkNode.href;*/
						/** Oh this saves Konqueror :) **/
						top.window.frames[1].location = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.86</LI>
		<BLOCKQUOTE>
			<LI class='done'>Added loading page (nice for feedback, annoying afterwards).</LI>
			<LI class='done'>I set links to open in the right frame when clicked, rather than leaving the frameset or opening a new window, although hover is usually sufficient anyway.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<!--
						These lines, although commented, were breaking the minitool when pasting it into Konqueror:
						/**Failing in every way to highlight the loaded(ing) preview:**/
						/*
						linkNode.text = &quot;*&quot;+linkNode.text+&quot;*&quot;;
						linkNode.color = &quot;#eeee00&quot;;
						linkNode.parentNode.style = &quot;bgcolor = #ffff00;&quot;;
						linkNode.parentNode.style.bgcolor = &quot;#ffff00&quot;;
						*/
		-->
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.85 - Good!</LI>
		<BLOCKQUOTE>
				<!-- heh it was worth a bash :p
				<SCRIPT type='text/javascript'>
					document.write('Maybe you want the ');
					document.write('<A id="splitPreviewBookmarkletWithClickToBreakOut">Older version</A>.');
					document.getElementById('splitPreviewBookmarkletWithClickToBreakOut').href = escape(document.getElementById('splitPreviewBookmarklet').href.replace('target = &quot;previewFrame&quot;','target = &quot;_parent&quot;'));
				</SCRIPT>
				-->
			</P>
			<LI class='done'>In this version only, links from the left pane open in a new tab/window when clicked.</LI>
			<!-- When I am using the Split Preview, I am very annoyed when I accidentally click and lose it!  In Konq, we need to reload the bookmarklet, we can't just 'go back'.. -->
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
						document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
						*/
						lastLoaded = linkNode;
						linkNode.text = &quot;WHEEE&quot;;
						/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
					document.links[i].target = &quot;_parent&quot;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** This works on Mozilla but not Konqueror. **/
			/*
			var scriptElement = window.frames[0].document.createElement('SCRIPT');
			scriptElement.type = 'text/javascript';
			scriptElement.innerHTML = scriptText;
			window.frames[0].document.documentElement.appendChild(scriptElement);
			*/
			/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
			/*window.frames[0].document.open();*/
			/** Prepending <pre> makes the text TT! **/
			/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
			/*
			oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
			*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.8</LI>
		<BLOCKQUOTE>
			<LI class='done'>In this version, clicking on a link causes it to open in the current tab, leaving the frameset.</LI>
		</BLOCKQUOTE>
	</P>

	<P>The only good thing about the initial IFrame implementations, is that we don&apos;t have to rebuild the DOM, we can successfully move the existing page inside the table.  The disadvantage is they they suck.  The sidebar needs a scrollbar too, but I couldn&apos;t successfully add the document into an IFrame.</P>

	<P class='todo'>The TABLE methods might not suck so terribly if we used CSS &apos;overflow: scroll;&apos;.

	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var f = document.createElement('IFRAME');
			f.id = 'myframe';
			f.width=window.innerWidth*55/100;
			f.height=window.innerHeight;
			d1.appendChild(document.documentElement);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+f.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			/* cheap and dirty close - should be right aligned, maybe a button with value X. */
			d2.appendChild(f);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview Prototype 0.4</A> - Poor
		<BLOCKQUOTE>
			<P>Instead of a floating IFrame, we split the view left/right and put the two panes inside a table.</P>
			<LI class='done'>Done: Using only onmouseover for hover detection is too sensitive.  We should also check: 1) user has hovered over the link for some time, and 2) the link being hovered on is not already loading!</LI>
			<LI class='done'>Done: Add Close button, to remove the floatingframe, and remove all the onmouseover events we added.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<!--
		
		DONE: Reloading the iframe every time we mouseover a link is a bit too much!
		We should at least check we aren't already loading this page, and that the user
		is hovering on our link, not just quickly passing over it to reach another.
		
		TODO: For real speed when flicking between previews, we should have 1 IFrame
		per link, but rotate/hide them so that only 1 is visible.  The background ones
		can load and be fast and ready.
		
		TODO: On Google, the floating IFrame does not appear where we desire.  This is
		consistent between Firefox and Konqueror!  Maybe we need to place the style tag
		in HTML rather than adding style prefs to the object.
		
		FIX: In Mozilla, our whole page gets replaced with '[object
		HTMLIFrameElement]', or whatever our last statement returns. The alert prevents
		it!
		
		-->
		<A href="
			javascript:(function(){
			var f = document.createElement('IFRAME');
			/* f.style = 'z-index:100'; */ /* breaks moz */
			f.align = 'left';
			/* f.src = 'blah.html'; */
			f.style.position = 'absolute';
			f.style.width = window.innerWidth * 3/4;
			f.style.height = window.innerHeight * 3/4;
			f.style.top = 20;
			f.style.right = 20;
			/* TODO: our lovely positioning breaks on google! */
			f.id = 'floatingFrame1';
			document.body.appendChild(f);
			function eventHandler(evt) {
				var linkNode = evt.currentTarget;
				document.getElementById('floatingFrame1').src = linkNode.href;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
			}
			})();
		">Popup Preview Prototype 0.3</A> - Poor
		<!-- Another workaround is to put the javascript in a button on the page.
		This does not suffer problem related to the return value.-->
		<!-- <INPUT type="button" value="Go" onclick=" -->
		<!-- "></INPUT> -->
		<BLOCKQUOTE>
			<P>Pops up a floating IFrame, where target pages are displayed when we hover over links on the current page.</P>
			<LI class='todo'>Bug: When invoked on Google result pages, the IFrame's floating style does not work properly - it sits at the bottom of the page.</LI>
			<LI class='todo'>Bug: It frequently covers up the links we want to hover over!</LI>
		</BLOCKQUOTE>
		<!--
		<div id='floatframe'>
			<iframe id='floatingFrame1' width='320' height='240' src='blah.html' align='left'> </iframe>
		</div>
		<style type="text/css">
			#floatframe {position:absolute;
				right:20px;
				top:20px;
				width:320px;
				height:240px;
				z-index:100;
			}
		</style>
		-->
	</P>

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			window.status = '1';
			/*d1.appendChild(document.documentElement);*/
			leftFrame.appendChild(document.documentElement);
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			d2.appendChild(rightFrame);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			/* leftFrame.src = document.location; */
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview New 0.1</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var target = document.location;
			document.open(); document.write('<HTML><BODY>bleh</BODY></HTML>'); document.close();
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			t.appendChild(r);
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			r.appendChild(d1);
			r.appendChild(d2);
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			d2.appendChild(rightFrame);
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			/*window.status = '1';*/
			/*d1.appendChild(document.documentElement);*/
			leftFrame.appendChild(document.documentElement);
			leftFrame.innerHTML = '<HTML><BODY>ffs</BODY></HTML>';
			/*leftFrame.src = target;*/
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview New 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var target = document.location;
			var oldHTML = document.documentElement.innerHTML;
			with(window.open(&quot;&quot;,&quot;_blank&quot;,&quot;width=&quot;+screen.width*.6+&quot;,left=&quot;+screen.width*.35+&quot;,height=&quot;+screen.height*.9+&quot;,resizable,scrollbars=yes&quot;)) {
				document.open();
				/*
				document.write('<HTML><BODY>\n');
				document.write('IFrame coming...<BR/>');
				document.write('<IFRAME>\n');
				document.write('Doc coming...<BR/>');
				oldHTML = oldHTML.replace(/%26/g,%27%26amp;%27).replace(/%3E/g,%27%26gt;%27).replace(/%3C/g,%27%26lt;%27);
				document.write(oldHTML);
				document.write('Doc done.<BR/>');
				document.write('</IFRAME>\n');
				document.write('IFrame done.<BR/>');
				document.write('</BODY></HTML>\n');
				*/
				document.write('<head><title>asdddd</title></head><frameset rows=&quot;25,*&quot;>\n');
				document.write('<frame name=&quot;leftFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
				document.write('<frame name=&quot;rightFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
				document.write('</frameset>\n');
				document.close();
				/*var text = document.createElement('DIV');
				text.innerHTML = '<BODY>HELLO</BODY>';*/
				/* document.getElementsByTagName('IFRAME')[0].appendChild(text); */
				/* document.getElementsByTagName('IFRAME')[0].write('<BODY>Hello</BODY>'); */
				frames[1].src = 'http://hwi.ath.cx/';
				frames[0].write('<HEAD>a frame</HEAD><BODY>Hello</BODY>');
				/* This throws an error, but it's what the PartialSource bookmarklet uses. */
			}
		})();">Split Preview New HTML 0.3</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('myframe').src = linkNode.href;
					document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text;
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var t = document.createElement('TABLE');
			var r = document.createElement('TR');
			var d1 = document.createElement('TD');
			var d2 = document.createElement('TD');
			d2.valign='top';
			d1.width=window.innerWidth*40/100+'px';
			d2.width=window.innerWidth*55/100+'px';
			var leftFrame = document.createElement('IFRAME');
			var rightFrame = document.createElement('IFRAME');
			rightFrame.id = 'myframe';
			rightFrame.width=window.innerWidth*55/100;
			rightFrame.height=window.innerHeight;
			leftFrame.appendChild(document.documentElement);
			/* leftFrame.innerHTML = document.documentElement.innerHTML; */
			d1.appendChild(leftFrame);
			d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
							 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
			/* cheap and dirty close - should be right aligned, maybe a button with value X. */
			d2.appendChild(rightFrame);
			r.appendChild(d1);
			r.appendChild(d2);
			t.appendChild(r);
			document.appendChild(t);
			document.doGet = doGet;
		})();">Split Preview Two IFrames 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<A href="javascript:(function(){
			var linkNode,lastLoaded;
			function doGet() {
				if (linkNode && linkNode != lastLoaded) {
					document.getElementById('rightFrame').src = linkNode.href;
					/* document.getElementById('previewlink').href = linkNode.href;
					document.getElementById('previewlink').innerHTML = linkNode.text; */
					lastLoaded = linkNode;
				}
			}
			function eventHandler(evt) {
				linkNode = evt.currentTarget;
				setTimeout('document.doGet();',1000);
			}
			function clearLinkNode() {
				linkNode = null;
			}
			for (var i=0;i<document.links.length;i++) {
				document.links[i].onmouseover = eventHandler;
				/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
				/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
				document.links[i].onmouseout = clearLinkNode;
			}
			var frameset = document.createElement('FRAMESET');
			frameset.rows = '40%,*';
			var leftFrame = document.createElement('FRAME');
			var rightFrame = document.createElement('FRAME');
			frameset.appendChild(leftFrame);
			frameset.appendChild(rightFrame);
			rightFrame.id = 'rightFrame';
			/* leftFrame.src = 'http://hwi.ath.cx/'; */
			rightFrame.src = 'about:blank';
			leftFrame.appendChild(document.documentElement);
			/* document.open(); document.close(); */
			document.appendChild(frameset);
			document.doGet = doGet;
		})();">Split Preview Frames 0.2</A>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>
	-->

	<!--
	<P>
		<LI><A href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;40%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
						document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
						*/
						lastLoaded = linkNode;
						linkNode.text = &quot;WHEEE&quot;;
						/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
					}
				}
				function eventHandler(evt) {
					linkNode = evt.currentTarget;
					setTimeout(&quot;doGet();&quot;,1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** This works on Mozilla but not Konqueror. **/
			/*
			var scriptElement = window.frames[0].document.createElement('SCRIPT');
			scriptElement.type = 'text/javascript';
			scriptElement.innerHTML = scriptText;
			window.frames[0].document.documentElement.appendChild(scriptElement);
			*/
			/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
			/*window.frames[0].document.open();*/
			/** Prepending <pre> makes the text TT! **/
			/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
			/*
			oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
			*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find the body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.79 - Good!</LI>
		<BLOCKQUOTE>
			<P>Splits the page, with the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.</P>
			<P><I>(Rejoice!  It was an effort but I nailed this critter.)</I></P>
			<LI class='todo'>Todo: Clicking on a link causes it to open in the sideFrame, but preferably the browser would drop the frames and go directly to the page.</LI>
		</BLOCKQUOTE>
	</P>
	-->

</BLOCKQUOTE>
</DIV>

<STYLE type='text/css'>
	.todo {
		/*font-size: -1;*/
		color: #775522;
	}
	.done {
		color: #005500;
	}
	.external {
		/*color: #aa4400;*/
		color: #999900;
	}
	.hiddenlink {
		color: #000000;
		text-decoration: none;
		cursor: crosshair;
	}
	.tip {
		background-color: #ffffdd;
		padding: 10px;
		border-style: solid;
		border-width: 1px;
		border-color: black;
	}
	h3 {
		color: white;
		/*background-color: #44bbbb;*/
		background-color: #4444ee;
		padding-left: 15px;
		padding-right: 10px;
		padding-top: 6px;
		padding-bottom: 4px;
		/*
		padding-bottom: 0px;
		*/
		margin-top: 0px;
	}
	.section {
		background-color: #ffffff;
		padding-top: 0px;
		padding-left: 0px;
		padding-right: 0px;
		padding-bottom: 10px;
		border-style: solid;
		border-width: 2px;
		border-color: black;
		/*border-style: solid;
		border-width: medium;
		border-color: #000000;*/
		margin-top: 10px;
	}
	blockquote {
		/* margin-left: 32px; */
	}
</STYLE>

<!--
Nice idea but it didn_t work.  It breaks all the bookmarklets!
<SCRIPT type='text/javascript'>
/*
var cnt = 0;
for (i=0;i<document.links.length;i++) {
	var link = document.links[i];
	if (link.href.indexOf('javascript:')==0) {
		cnt++;
		link.href = escape(link.href);
	}
}
document.writeln('<P>Escaped '+cnt+" bookmarklets.</P>");
*/
</SCRIPT>
-->

<P>Some inspiration for scripts was drawn from the collection at <A href="https://www.squarefree.com/bookmarklets/">Jesse&apos;s Bookmarklets Site</A> at squarefree.com.</P>

<P class='todo'>I should salvage whatever Bookmarklets were previously available on <A href="http://web.archive.org/web/20070908140900/http://www.jsquickmark.com/">jsquickmark.com</A>.</P>

<H4>Comments / Feedback</H4>
<BLOCKQUOTE>
<IFRAME width="100%" height="200px" src="http://hwi.ath.cx/hwikalong/?url=http%3A//hwi.ath.cx/joeys_bookmarklets.html%23dev&amp;title="/>
</BLOCKQUOTE>

<SCRIPT>
if (alert.oldconfirm) {
	document.write("<P align='right'>You are protected from infinite alert loops by <A href='http://hwi.ath.cx/javascript/alert_watcher.user.js'>alert_watcher script</A>.</P>");
}
</SCRIPT>

</BODY>
</HTML>
