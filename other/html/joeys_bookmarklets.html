<HTML>
<HEAD><TITLE>Joey's Bookmarklet (Development) Page</TITLE></HEAD>
<BODY>

<H2>Joey's Bookmarklet (Development) Page</H2>

<P align='right'>
See also: <A href='http://hwi.ath.cx/xslt/live/minitools/show_minitools.html'>Joey's Minitools/Bookmarklets</A>
</P>

Click on a bookmarklet link to try it out.  (Reload the page or navigate back if you don't like the results!)
<BR/>
To 'install' a bookmarklet, drag the link to your Bookmarks Toolbar, or right-click to bookmark it.
<BR/>
Known bugs and TODOs are <font class='todo'>shown in orange</font>.

<H3>Ready to use Bookmarklets</H3>
<BLOCKQUOTE>

	<P>
		<!--
						These lines, although commented, were breaking the minitool when pasting it into Konqueror:
						/**Failing in every way to highlight the loaded(ing) preview:**/
						/*
						linkNode.text = &quot;*&quot;+linkNode.text+&quot;*&quot;;
						linkNode.color = &quot;#eeee00&quot;;
						linkNode.parentNode.style = &quot;bgcolor = #ffff00;&quot;;
						linkNode.parentNode.style.bgcolor = &quot;#ffff00&quot;;
						*/
		-->
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; name=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						/*var rightFrame = top.document.getElementById(&quot;previewFrame&quot;);*/
						/*top.window.frames[1].document.documentElement.innerHTML = ... ;*/
						top.window.frames[1].document.write(&quot;&lt;BODY&gt;Loading &quot;+linkNode.href+&quot;...&lt;/BODY&gt;&quot;);
						/** Writing to the frame above causes the line below to fail in Konqueror. **/
						/** One fix might be to embed some javascript inside the body we just posted, to redirect the frame/page/doc. **/
						/*top.window.frames[1].src = linkNode.href;*/
						/** Oh this saves Konqueror :) **/
						top.window.frames[1].location = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = (evt.srcElement ? evt.srcElement /*moz*/ : evt.currentTarget /*not moz*/ );
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find ze body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.86 - added loading page (nice for feedback, annoying afterwards)</LI>
		<BLOCKQUOTE>
			<P>Splits the page, placing the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.
			<LI>I have set links to open in the right frame when clicked, rather than leaving the frameset or opening a new window, although hover is usually sufficient anyway.</LI>
			<P class='todo'>Todo:</P>
			<BLOCKQUOTE>
				<LI class='todo'>Open the first link automatically.</LI>
				<LI class='todo'>Highlight in the left pane, the currently previewed link.</LI>
				<LI class='todo'>Thin frame across the top of the two panes, containing all the buttons+options, including Next/Previous buttons.</LI>
				<LI class='todo'>There should be two close buttons available to the user, one for each frame.</LI>
				<LI class='todo'>Maybe also a squish/unsquish button for the sidebar (temporarily almost-maximize preview frame)?</LI>
				<LI class='todo'>Also might be nice to have 'MoveRightFrameToLeft' and also a back button for that feature.  This would describe a sort of history-tree-browsing way or surfing, somewhat similar to the early Gnome2 file-chooser.</LI>
				<LI class='todo'>Consider an alternative approach: forget the left frame, just have a thin top frame with all the links from the page presented as tabs, which open in the mainframe below.  We could even do this without frames, just a table and an IFrame (or a hidden stack/cache of IFrames).</LI>
			</BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<!--
						These lines, although commented, were breaking the minitool when pasting it into Konqueror:
						/**Failing in every way to highlight the loaded(ing) preview:**/
						/*
						linkNode.text = &quot;*&quot;+linkNode.text+&quot;*&quot;;
						linkNode.color = &quot;#eeee00&quot;;
						linkNode.parentNode.style = &quot;bgcolor = #ffff00;&quot;;
						linkNode.parentNode.style.bgcolor = &quot;#ffff00&quot;;
						*/
		-->
		<LI><A id='splitPreviewBookmarklet' href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = (evt.srcElement ? evt.srcElement /*moz*/ : evt.currentTarget /*not moz*/ );
					setTimeout(&quot;doGet();&quot;,700);
				}
				function clearLinkNode() {
					setTimeout(&quot;&quot;);
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					/*document.links[i].target = &quot;_parent&quot;;*/
					document.links[i].target = &quot;previewFrame&quot;;
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** We can do .BODY but I prefer to push the / through with a
			 * backslash.  But this can still fail, e.g. on bookmarklet pages, if
			 * an earlier /BODY is seen and replaced. */
			/*oldHTML = oldHTML.replace(/%3C\/BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');*/
			/** This never fails. **/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find ze body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.85 - Good!</LI>
		<BLOCKQUOTE>
				<!-- heh it was worth a bash :p
				<SCRIPT type='text/javascript'>
					document.write('Maybe you want the ');
					document.write('<A id="splitPreviewBookmarkletWithClickToBreakOut">Older version</A>.');
					document.getElementById('splitPreviewBookmarkletWithClickToBreakOut').href = escape(document.getElementById('splitPreviewBookmarklet').href.replace('target = &quot;previewFrame&quot;','target = &quot;_parent&quot;'));
				</SCRIPT>
				-->
			</P>
			<LI>In this version only, links from the left pane open in a new tab/window when clicked.</LI>
			<!-- When I am using the SplitPreview, I am very annoyed when I accidentally click and lose it!  In Konq, we need to reload the bookmarklet, we can't just 'go back'.. -->
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var oldHTML = document.documentElement.innerHTML;
			document.write('<head><title>Previewing '+document.title+'</title></head>\n');
			document.write('<frameset cols=&quot;35%25,*&quot;>\n');
			document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
			document.write('</frameset>\n');
			/*document.close();*/
			var scriptText = '
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
						/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
						document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
						*/
						lastLoaded = linkNode;
						linkNode.text = &quot;WHEEE&quot;;
						/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout(&quot;doGet();&quot;,1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					document.links[i].onmouseout = clearLinkNode;
					document.links[i].target = &quot;_parent&quot;
				}
				document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
			';
			/** This works on Mozilla but not Konqueror. **/
			/*
			var scriptElement = window.frames[0].document.createElement('SCRIPT');
			scriptElement.type = 'text/javascript';
			scriptElement.innerHTML = scriptText;
			window.frames[0].document.documentElement.appendChild(scriptElement);
			*/
			/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
			/*window.frames[0].document.open();*/
			/** Prepending <pre> makes the text TT! **/
			/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
			/*
			oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
			*/
			var i = oldHTML.lastIndexOf('%3C/body%3E');
			if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
			if (i<=0) { alert('Failed to find ze body tag!'); }
			oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
			if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
			/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
			window.frames[0].document.write(oldHTML);
			window.frames[0].document.close();
			window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
			window.frames[1].document.close();
			document.close();
		})();">Split Preview</A> 0.8</LI>
		<BLOCKQUOTE>
			<LI>In this version, clicking on a link causes it to open in the current tab, leaving the frameset.</LI>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="
			javascript:
			function attachClickListener(node,clickProcessor) {
				if (node.captureEvents) {
					node.captureEvents(Event.CLICK);
				}
				node.onmouseup = clickProcessor;
				if (node.style) {
					node.style.cursor = (clickProcessor?'crosshair':'');
				}
				var kids = node.childNodes;
				for (var i=0;i<kids.length;i++) {
					attachClickListener(kids[i],clickProcessor);
				}
			}
			function processClick(event) {
				var node = event.srcElement;
				if (!node) {
					node = event.currentTarget;
				}
				window.status = 'Removed '+node;
				attachClickListener(document,null);
				node.innerHTML='';
				node.parentNode.removeChild(node);
			}
			attachClickListener(document,processClick);
		">Nuke next item clicked</A></LI>
	<BLOCKQUOTE>
		<P>Waits for user click, and removes whatever element they clicked on from the page.</P>
		<LI class='todo'>Todo: Needs 'undo' feature.</LI>
		<LI class='todo'>Todo: Add two icons to the page, one to re-use the bookmarklet, another to empty the Trash (undo the deletes).</LI>
		<LI class='todo'>Todo: Add info about what was destroyed (e.g. display its XPath in the statusbar, or in Trash list).</LI>
		<LI class='todo'>Todo: The element we want to destroy might not have any exposed surface to click on.  Maybe we can fatten out invisible/zero-size elements.  (E.g. mark each with a '.'s and give info on mouseover?)</LI>
	</BLOCKQUOTE>
	</P>

	<!-- I found by setting target='_self', the URL in my browser's location bar was not changed to the script text, which looked messy. -->

	<P>
		<LI><A target='_self' href='javascript:
			var info = document.links.length+" links on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<document.links.length;i++) {
				var link = document.links[i];
				html += "<TR><TD><A href=\""+(link.href)+"\">"+(link.text)+"</A></TD><TD>"+(link.href)+"</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			document.open();
			document.write(html);
			document.close();
		'>Just the Links</A> - this works badly on this page because the page is poorly formatted.  But it works fine on valid pages!</LI>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			var images = document.getElementsByTagName("IMG"),
					info = images.length+" images on <A href=\""+document.location+"\">"+document.title+"</A>";
			var html = "<HTML><HEAD><TITLE>"+info+"</TITLE></HEAD><BODY><H2>"+info+"</H2><TABLE>\n";
			for (i=0;i<images.length;i++) {
				var image = images[i];
				html += "<TR><TD align=\"center\">\n";
				html += "&lt;IMG src=\""+image.src+"\"&gt;<BR/>\n";
				html += "<A href=\""+image.src+"\">"+image.src+"</A>\n";
				html += "</TD></TR>\n";
			}
			html += "</TABLE></BODY></HTML>\n";
			/* var w = open().document; */
			var w = document;
			w.open();
			w.write(html);
			w.close();
		'>Just the Images</A></LI>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_blank";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_blank";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at New Window</A></LI>
		<BLOCKQUOTE>
			Use this if you want the browser to open a new window when you click on a link or button.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A target='_self' href='javascript:
			(function(){
				for (i=0;i<document.links.length;i++) {
					document.links[i].target = "_self";
				}
				for (i=0;i<document.forms.length;i++) {
					document.forms[i].target = "_self";
				}
				window.status = "Updated "+document.links.length+" links and "+document.forms.length+" forms.";
			})();
		'>Target Links and Forms at This Window</A></LI>
		<BLOCKQUOTE>
			Use this if you do not want the browser to open a new window when you click on a link or button.
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="
			javascript:(function(){
				theForm = document.forms[0];
				theStr = '';
				for (i=0; i < theForm.elements.length; i++) {
					ele = theForm.elements[i];
					theStr += ele.name + ' : ' + ele.value + '\n';
				}
				alert (theStr);
			})();
		">Copy form</A></LI>
		<BLOCKQUOTE>
		</BLOCKQUOTE>
	</P>

	<P>
		<LI><A href="javascript:(function(){
			var cnt = 0;
			function doneLoading() {
				if (this.addFoldsToBlockQuotes != undefined) {
					/*alert('script_ready = ' + document.getElementsByTagName('SCRIPT').innerHTML);*/
					/*alert('script_ready = ' + this.addFoldsToBlockQuotes);*/
					/*alert('Loading complete.');*/
					addFoldsToBlockQuotes();
					/*alert('script_ready = '+document.getElementsByTagName('SCRIPT').readyState);*/
				} else {
					window.status = 'Waiting for script to load...'+(++cnt)*5+'ms';
					setTimeout('top.doneLoading();',5);
				}
			}
			top.doneLoading = doneLoading;

			var newScript = document.createElement('script');
			newScript.type = 'text/javascript';
			newScript.src = 'http://hwi.ath.cx/javascript/modifyDOM.js';
			newScript.onload = doneLoading;
			/** I thought this might work for Konqueror but it didn't: **/
			/*newScript.onload = 'javascript:document.doneLoading();';*/
			document.getElementsByTagName('head')[0].appendChild(newScript);
			setTimeout('top.doneLoading();',5);
		})();" keyword="keywordInjected" description="descriptionInjected" title="Version 0.9">Page Folding = ON</A></LI>
	</P>
	<!-- Nasty - FF was reloading all the resources except mosifyDOM.js, which is the one I was changing!  -->
	<BLOCKQUOTE>
		<P>Makes parts of the page collapsable and expandable, for easier navigation through large (tree-structured) pages.</P>
		<LI class='todo'>Fixed: If the item we decide to use as the handle is a link, clicking on it clicks the link, as well as collapsing/expanding the child block, which is undesirable.  The fix is that the user can open/close those folds now by hovering over the handle. Todo: Avoid the real cause of the problem, by making sure the fold handle image sits outside the link.</LI>
	</BLOCKQUOTE>

</BLOCKQUOTE>

<H3>Development Bookmarklets (Do not work well)</H3>
<BLOCKQUOTE>

	<!-- <P>No bookmarklet in development on this page right now.  You probably wouldn't want to use it if it was. -->
	<!-- I might even consider separating my development and release pages. --></P>

	<P>
		<!-- <INPUT type="button" value="Go" onclick="document.getElementsByTagName('IFRAME')[0].src='http://www.google.com/';" ></INPUT> -->
		<!-- <A href="javascript: alert(document.getElementsByTagName('IFRAME')); document.getElementsByTagName('IFRAME')[0].src='http://www.google.com/';" >Test</A> -->
		<!-- <A onmouseover="javascript: document.getElementById('floatingFrame1').src=href;" href="http://hwi.ath.cx/">TEST</A> -->
		<!-- <A onmouseover="javascript: document.getElementById('floatingFrame1').src=href;" href="http://hwi.ath.cx/">TEST</A> -->
	</P>

	<H4>Old attempts:</H4>
	<BLOCKQUOTE>

		<P>
			<!--
			
			DONE: Reloading the iframe every time we mouseover a link is a bit too much!
			We should at least check we aren't already loading this page, and that the user
			is hovering on our link, not just quickly passing over it to reach another.
			
			TODO: For real speed when flicking between previews, we should have 1 IFrame
			per link, but rotate/hide them so that only 1 is visible.  The background ones
			can load and be fast and ready.
			
			TODO: On Google, the floating IFrame does not appear where we desire.  This is
			consistent between Firefox and Konqueror!  Maybe we need to place the style tag
			in HTML rather than adding style prefs to the object.
			
			FIX: In Mozilla, our whole page gets replaced with '[object
			HTMLIFrameElement]', or whatever our last statement returns. The alert prevents
			it!
			
			-->
			<A href="
				javascript:(function(){
				var f = document.createElement('IFRAME');
				/* f.style = 'z-index:100'; */ /* breaks moz */
				f.align = 'left';
				/* f.src = 'blah.html'; */
				f.style.position = 'absolute';
				f.style.width = window.innerWidth * 3/4;
				f.style.height = window.innerHeight * 3/4;
				f.style.top = 20;
				f.style.right = 20;
				/* TODO: our lovely positioning breaks on google! */
				f.id = 'floatingFrame1';
				document.body.appendChild(f);
				function eventHandler(evt) {
					var linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					document.getElementById('floatingFrame1').src = linkNode.href;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
				}
				})();
			">Split Preview Prototype 0.3</A>
			<!-- Another workaround is to put the javascript in a button on the page.
			This does not suffer problem related to the return value.-->
			<!-- <INPUT type="button" value="Go" onclick=" -->
			<!-- "></INPUT> -->
			<BLOCKQUOTE>
				<P>Pops up a floating IFrame, where target pages are displayed when we hover over links on the current page.</P>
				<LI class='todo'>Bug: When invoked on Google result pages, the IFrame's floating style does not work properly - it sits at the bottom of the page.</LI>
				<LI class='todo'>Bug: It frequently covers up the links we want to hover over!</LI>
			</BLOCKQUOTE>
			<!--
			<div id='floatframe'>
				<iframe id='floatingFrame1' width='320' height='240' src='blah.html' align='left'> </iframe>
			</div>
			<style type="text/css">
				#floatframe {position:absolute;
					right:20px;
					top:20px;
					width:320px;
					height:240px;
					z-index:100;
				}
			</style>
			-->
		</P>

		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('myframe').src = linkNode.href;
						document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var t = document.createElement('TABLE');
				var r = document.createElement('TR');
				var d1 = document.createElement('TD');
				var d2 = document.createElement('TD');
				d2.valign='top';
				d1.width=window.innerWidth*40/100+'px';
				d2.width=window.innerWidth*55/100+'px';
				var f = document.createElement('IFRAME');
				f.id = 'myframe';
				f.width=window.innerWidth*55/100;
				f.height=window.innerHeight;
				d1.appendChild(document.documentElement);
				d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+f.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
								 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
				/* cheap and dirty close - should be right aligned, maybe a button with value X. */
				d2.appendChild(f);
				r.appendChild(d1);
				r.appendChild(d2);
				t.appendChild(r);
				document.appendChild(t);
				document.doGet = doGet;
			})();">Split Preview Prototype 0.4</A>
			<BLOCKQUOTE>
				<LI class='done'>Done: Using only onmouseover for hover detection is too sensitive.  We should also check: 1) user has hovered over the link for some time, and 2) the link being hovered on is not already loading!</LI>
				<LI class='done'>Done: Add Close button, to remove the floatingframe, and remove all the onmouseover events we added.</LI>
			</BLOCKQUOTE>
		</P>

		<!--
		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('myframe').src = linkNode.href;
						document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var t = document.createElement('TABLE');
				var r = document.createElement('TR');
				var d1 = document.createElement('TD');
				var d2 = document.createElement('TD');
				d2.valign='top';
				d1.width=window.innerWidth*40/100+'px';
				d2.width=window.innerWidth*55/100+'px';
				var leftFrame = document.createElement('IFRAME');
				var rightFrame = document.createElement('IFRAME');
				rightFrame.id = 'myframe';
				rightFrame.width=window.innerWidth*55/100;
				rightFrame.height=window.innerHeight;
				window.status = '1';
				/*d1.appendChild(document.documentElement);*/
				leftFrame.appendChild(document.documentElement);
				d1.appendChild(leftFrame);
				d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
								 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
				d2.appendChild(rightFrame);
				r.appendChild(d1);
				r.appendChild(d2);
				t.appendChild(r);
				/* leftFrame.src = document.location; */
				document.appendChild(t);
				document.doGet = doGet;
			})();">Split Preview New 0.1</A>
			<BLOCKQUOTE>
			</BLOCKQUOTE>
		</P>
		-->

		<!--
		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('myframe').src = linkNode.href;
						document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var target = document.location;
				document.open(); document.write('<HTML><BODY>bleh</BODY></HTML>'); document.close();
				var t = document.createElement('TABLE');
				var r = document.createElement('TR');
				t.appendChild(r);
				var d1 = document.createElement('TD');
				var d2 = document.createElement('TD');
				d2.valign='top';
				d1.width=window.innerWidth*40/100+'px';
				d2.width=window.innerWidth*55/100+'px';
				r.appendChild(d1);
				r.appendChild(d2);
				var leftFrame = document.createElement('IFRAME');
				var rightFrame = document.createElement('IFRAME');
				d1.appendChild(leftFrame);
				d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
								 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
				d2.appendChild(rightFrame);
				rightFrame.id = 'myframe';
				rightFrame.width=window.innerWidth*55/100;
				rightFrame.height=window.innerHeight;
				/*window.status = '1';*/
				/*d1.appendChild(document.documentElement);*/
				leftFrame.appendChild(document.documentElement);
				leftFrame.innerHTML = '<HTML><BODY>ffs</BODY></HTML>';
				/*leftFrame.src = target;*/
				document.appendChild(t);
				document.doGet = doGet;
			})();">Split Preview New 0.2</A>
			<BLOCKQUOTE>
			</BLOCKQUOTE>
		</P>
		-->

		<!--
		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('myframe').src = linkNode.href;
						document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var target = document.location;
				var oldHTML = document.documentElement.innerHTML;
				with(window.open(&quot;&quot;,&quot;_blank&quot;,&quot;width=&quot;+screen.width*.6+&quot;,left=&quot;+screen.width*.35+&quot;,height=&quot;+screen.height*.9+&quot;,resizable,scrollbars=yes&quot;)) {
					document.open();
					/*
					document.write('<HTML><BODY>\n');
					document.write('IFrame coming...<BR/>');
					document.write('<IFRAME>\n');
					document.write('Doc coming...<BR/>');
					oldHTML = oldHTML.replace(/%26/g,%27%26amp;%27).replace(/%3E/g,%27%26gt;%27).replace(/%3C/g,%27%26lt;%27);
					document.write(oldHTML);
					document.write('Doc done.<BR/>');
					document.write('</IFRAME>\n');
					document.write('IFrame done.<BR/>');
					document.write('</BODY></HTML>\n');
					*/
					document.write('<head><title>asdddd</title></head><frameset rows=&quot;25,*&quot;>\n');
					document.write('<frame name=&quot;leftFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
					document.write('<frame name=&quot;rightFrame&quot; src=&quot;about:blank&quot; noresize=&quot;&quot;>\n');
					document.write('</frameset>\n');
					document.close();
					/*var text = document.createElement('DIV');
					text.innerHTML = '<BODY>HELLO</BODY>';*/
					/* document.getElementsByTagName('IFRAME')[0].appendChild(text); */
					/* document.getElementsByTagName('IFRAME')[0].write('<BODY>Hello</BODY>'); */
					frames[1].src = 'http://hwi.ath.cx/';
					frames[0].write('<HEAD>a frame</HEAD><BODY>Hello</BODY>');
					/* This throws an error, but it's what the PartialSource bookmarklet uses. */
				}
			})();">Split Preview New HTML 0.3</A>
			<BLOCKQUOTE>
			</BLOCKQUOTE>
		</P>
		-->

		<!--
		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('myframe').src = linkNode.href;
						document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text;
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var t = document.createElement('TABLE');
				var r = document.createElement('TR');
				var d1 = document.createElement('TD');
				var d2 = document.createElement('TD');
				d2.valign='top';
				d1.width=window.innerWidth*40/100+'px';
				d2.width=window.innerWidth*55/100+'px';
				var leftFrame = document.createElement('IFRAME');
				var rightFrame = document.createElement('IFRAME');
				rightFrame.id = 'myframe';
				rightFrame.width=window.innerWidth*55/100;
				rightFrame.height=window.innerHeight;
				leftFrame.appendChild(document.documentElement);
				/* leftFrame.innerHTML = document.documentElement.innerHTML; */
				d1.appendChild(leftFrame);
				d2.innerHTML = '<TABLE bgcolor=\'#bbbbff\' width=\''+rightFrame.width+'\'><TR><TD><A id=\'previewlink\'>Preview</A></TD>'
								 + '<TD align=\'right\'>[ <A href=\'javascript:document.location=&quot;'+document.location+'&quot;;\'>Close</A> ]</TD></TR></TABLE>\n';
				/* cheap and dirty close - should be right aligned, maybe a button with value X. */
				d2.appendChild(rightFrame);
				r.appendChild(d1);
				r.appendChild(d2);
				t.appendChild(r);
				document.appendChild(t);
				document.doGet = doGet;
			})();">Split Preview Two IFrames 0.2</A>
			<BLOCKQUOTE>
			</BLOCKQUOTE>
		</P>

		<P>
			<A href="javascript:(function(){
				var linkNode,lastLoaded;
				function doGet() {
					if (linkNode && linkNode != lastLoaded) {
						document.getElementById('rightFrame').src = linkNode.href;
						/* document.getElementById('previewlink').href = linkNode.href;
						document.getElementById('previewlink').innerHTML = linkNode.text; */
						lastLoaded = linkNode;
					}
				}
				function eventHandler(evt) {
					linkNode = evt.srcElement; /*moz?*/
					if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
					setTimeout('document.doGet();',1000);
				}
				function clearLinkNode() {
					linkNode = null;
				}
				for (var i=0;i<document.links.length;i++) {
					document.links[i].onmouseover = eventHandler;
					/* document.links[i].onmouseout = 'setTimeout(&quot;&quot;,1000);'; */
					/* document.links[i].onmouseout = '(function(){clearLinkNode();}'; */
					document.links[i].onmouseout = clearLinkNode;
				}
				var frameset = document.createElement('FRAMESET');
				frameset.rows = '40%,*';
				var leftFrame = document.createElement('FRAME');
				var rightFrame = document.createElement('FRAME');
				frameset.appendChild(leftFrame);
				frameset.appendChild(rightFrame);
				rightFrame.id = 'rightFrame';
				/* leftFrame.src = 'http://hwi.ath.cx/'; */
				rightFrame.src = 'about:blank';
				leftFrame.appendChild(document.documentElement);
				/* document.open(); document.close(); */
				document.appendChild(frameset);
				document.doGet = doGet;
			})();">Split Preview Frames 0.2</A>
			<BLOCKQUOTE>
			</BLOCKQUOTE>
		</P>
		-->

		<!--
		<P>
			<LI><A href="javascript:(function(){
				var oldHTML = document.documentElement.innerHTML;
				document.write('<head><title>Previewing '+document.title+'</title></head>\n');
				document.write('<frameset cols=&quot;40%25,*&quot;>\n');
				document.write('<frame id=&quot;sideFrame&quot; src=&quot;about:blank&quot;>\n');
				document.write('<frame id=&quot;previewFrame&quot; src=&quot;about:blank&quot;>\n');
				document.write('</frameset>\n');
				/*document.close();*/
				var scriptText = '
					var linkNode,lastLoaded;
					function doGet() {
						if (linkNode && linkNode != lastLoaded) {
							top.document.getElementById(&quot;previewFrame&quot;).src = linkNode.href;
							/*document.getElementById(&quot;previewlink&quot;).href = linkNode.href;
							document.getElementById(&quot;previewlink&quot;).innerHTML = linkNode.text;
							*/
							lastLoaded = linkNode;
							linkNode.text = &quot;WHEEE&quot;;
							/*alert(&quot;doGet called with linkNode = &quot;+linkNode);*/
						}
					}
					function eventHandler(evt) {
						linkNode = evt.srcElement; /*moz?*/
						if (!linkNode) { linkNode = evt.currentTarget; } /*not moz?*/
						setTimeout(&quot;doGet();&quot;,1000);
					}
					function clearLinkNode() {
						linkNode = null;
					}
					for (var i=0;i<document.links.length;i++) {
						document.links[i].onmouseover = eventHandler;
						document.links[i].onmouseout = clearLinkNode;
					}
					document.writeln(&quot;&lt;P&gt;&quot;+document.links.length+&quot; links prepared for rollover.&lt;/P&gt;&quot;);
				';
				/** This works on Mozilla but not Konqueror. **/
				/*
				var scriptElement = window.frames[0].document.createElement('SCRIPT');
				scriptElement.type = 'text/javascript';
				scriptElement.innerHTML = scriptText;
				window.frames[0].document.documentElement.appendChild(scriptElement);
				*/
				/*window.frames[0].document.write('<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n');*/
				/*window.frames[0].document.open();*/
				/** Prepending <pre> makes the text TT! **/
				/*oldHTML = oldHTML.replace(/&quot;/g,%27%26quot;%27);*/
				/*
				oldHTML = oldHTML.replace(/%3C.BODY%3E/i,'&lt;HEAD&gt;\n&lt;SCRIPT type=&quot;text/javascript&quot;&gt;'+scriptText+'&lt;/SCRIPT&gt;\n');
				*/
				var i = oldHTML.lastIndexOf('%3C/body%3E');
				if (i<=0) i = oldHTML.lastIndexOf('%3C/BODY%3E');
				if (i<=0) { alert('Failed to find ze body tag!'); }
				oldHTML = oldHTML.substring(0,i) + '<SCRIPT type=&quot;text/javascript&quot;>'+scriptText+'</SCRIPT>\n' + oldHTML.substring(i);
				if (oldHTML.indexOf(scriptText) <= 0) { alert('Insert failed.'); }
				/*alert('Final HTML = '+oldHTML.substring(i-40,i+60));*/
				window.frames[0].document.write(oldHTML);
				window.frames[0].document.close();
				window.frames[1].document.write('&lt;BODY&gt;Hover over links on the left to see a preview here.&lt;/BODY&gt;');
				window.frames[1].document.close();
				document.close();
			})();">Split Preview</A> 0.79 - Good!</LI>
			<BLOCKQUOTE>
				<P>Splits the page, with the current page on the left, and a preview window on the right.  The user can hover over a link to see its preview.</P>
				<P><I>(Rejoice!  It was an effort but I nailed this critter.)</I></P>
				<LI class='todo'>Todo: Clicking on a link causes it to open in the sideFrame, but preferably the browser would drop the frames and go directly to the page.</LI>
			</BLOCKQUOTE>
		</P>
		-->

	</BLOCKQUOTE>

</BLOCKQUOTE>

<H3>Wanted / TODO</H3>
<BLOCKQUOTE class='todo'>

	<P>
		HighlightLevels
		<P>e.g. the structure of this page, whilst tree-like, is not immediately intuitive.  However if we were to set the background of all level 1 DIVs to green, and level 2 DIVs to blue, and level 3 BLOCKQUOTES to orange, etc., the page might be easier to navigate. </P>
	</P>

	<P>
		MakeABookmarkletFromTheSearchFormOnThisPage ^^
	</P>

	<P>
		To help page investigation, colour every element (a bit like XPathGrabber does).
		And when we mouseover an element, show which one it is in the StatusBar (e.g. show it's XPath, since colour won't be possible in the StatusBar)p.
	</P>

	<P>
		Something similar to Preview Links in FloatingFrame, but instead split
		the window into two frames, put the current page in the left frame, and
		make all its links open the page in the right frame (when clicked, or
		hovered).
		It would be desirable to allow the split to be resized by the user.
		Also, be able to close the sideframe, or close the main frame.
	</P>

	<P>
		If I am viewing a page which is the result of a Google search, I may decide that the page is useless, and want to view another result.
		It would be great if the page could have a little icon added, which on hover would show the other search results, and let me switch to one of them.
		We may be able to use Referrer to determine if this page was obtained from a search-results page.  (Although actually, we could consider 'any' page as a 'list-of-links', we don't have to restrict this feature to search-result pages only.)
	</P>

	<P>
	<A href='javascript:
		'>Invisibly preload links when I mouseover them</A>
	<BLOCKQUOTE>
		Sometimes I am reading a page but I know where I am likely to go next.
		If I can preload that page then when I do follow the link, it will load fast when I do click.
	</BLOCKQUOTE>
	</P>

	<P>
		StripSearch.  Hides all elements except those containing the search text.  Ideal for tables.
	</P>

	<P>BatchNuke (aka BatchSelect*-1): User is given text box to enter an XPath.  (He can get xpath hints by mouseover the document.)  As he types the XPath, elements of the page are hidden, until he finds the XPath he wants.  Then he hits enter, they are permanently hidden/destroyed, and he can enter another XPath if he wishes.</P>

	<P>JavascriptConsole: Konqueror does not accept javascript: commands in the location bar.  How can I run little snippets of javascript on the page?  This Bookmarklet should popup a floating IFrame with a textarea where the user can edit and execute Javascript, and close it when finished.  For debugging but also for power-processing of pages.  (We may wish to append/include external .js files.)</P>

	<P>Bookmarklets and Framesets do not mix well.  Most Bookmarklets will try to target the frameset document rather than the child frame we are trying to focus on.  It would be nice to have a generic solution to this.</P>

</BLOCKQUOTE>

<STYLE type='text/css'>
	.todo {
		/*font-size: -1;*/
		color: #884400;
	}
</STYLE>

<!--
Nice idea but it didn_t work.  It breaks all the bookmarklets!
<SCRIPT type='text/javascript'>
/*
var cnt = 0;
for (i=0;i<document.links.length;i++) {
	var link = document.links[i];
	if (link.href.indexOf('javascript:')==0) {
		cnt++;
		link.href = escape(link.href);
	}
}
document.writeln('<P>Escaped '+cnt+" bookmarklets.</P>");
*/
</SCRIPT>
-->

</BODY>
</HTML>
